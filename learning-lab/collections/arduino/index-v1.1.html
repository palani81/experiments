<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mission: Spark City</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Nunito',sans-serif; background:#131a2b; color:#e2e8f0; transition: background 0.4s; }
:root {
  --green:#22c55e; --blue:#3b82f6; --purple:#a855f7; --orange:#f97316;
  --red:#ef4444; --yellow:#eab308; --cyan:#06b6d4; --pink:#ec4899;
}

/* Scrollbar */
::-webkit-scrollbar { width:8px; }
::-webkit-scrollbar-track { background:#1e293b; }
::-webkit-scrollbar-thumb { background:#475569; border-radius:4px; }

/* Code blocks */
pre { background:#0d1117; border:1px solid #30363d; border-radius:8px; padding:16px; overflow-x:auto; font-size:13px; line-height:1.6; }
code { font-family:'Fira Code','Courier New',monospace; }
.kw { color:#ff7b72; } .fn { color:#d2a8ff; } .str { color:#a5d6ff; }
.cm { color:#8b949e; } .num { color:#79c0ff; } .type { color:#ffa657; }

/* Animations */
@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
@keyframes slideIn { from { transform: translateX(-20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
@keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }
@keyframes popIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
@keyframes xpPop { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-40px) scale(0.7); opacity: 0; } }

.fadeIn { animation: fadeIn 0.4s ease; }
.pulse { animation: pulse 2s ease-in-out infinite; }
.bounce { animation: bounce 0.6s ease infinite; }
.popIn { animation: popIn 0.4s ease; }
</style>
</head>
<body>
<div id="root">
  <div style="min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#131a2b;color:#e2e8f0;font-family:sans-serif">
    <div style="font-size:64px;margin-bottom:16px;animation:bounce 1s infinite">ðŸ¤–</div>
    <div style="font-size:20px;font-weight:700;margin-bottom:8px">Mission: Spark City</div>
    <div style="font-size:14px;color:#64748b">Loading your mission...</div>
  </div>
</div>
<script>

const { useState, useEffect, useRef, useCallback, useMemo } = React;

// â”€â”€â”€ PROJECT DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PROJECTS = [
  {
    id: 1,
    title: "Hello LED!",
    subtitle: "Your first blink",
    icon: "ðŸ’¡",
    difficulty: 1,
    category: "Basics",
    color: "#22c55e",
    time: "15 min",
    questTitle: "Sparky's Eye Light is Broken!",
    questIntro: "Oh no! Sparky's eye light is fried! We need to fix it by learning to control an LED. This will teach Sparky to see again!",
    systemRepaired: "Eye Light",
    components: ["Arduino Uno", "USB Cable", "1 LED", "1 Resistor (220Î©)", "Breadboard", "2 Jumper wires"],
    learn: ["How circuits work", "Digital output pins", "Uploading code to Arduino"],
    description: "Every inventor starts here! You'll make an LED blink on and off â€” it's like teaching your Arduino to wave hello.",
    wiring: [
      { from: "Arduino Pin 13", to: "Resistor (220Î©)", note: "Connect with a jumper wire" },
      { from: "Resistor", to: "LED long leg (+)", note: "The longer leg is positive (anode)" },
      { from: "LED short leg (âˆ’)", to: "Arduino GND", note: "GND means Ground â€” the return path" }
    ],
    code: `// Project 1: Hello LED!
// Make an LED blink on and off

void setup() {
  pinMode(13, OUTPUT);  // Tell Arduino: pin 13 is an output
}

void loop() {
  digitalWrite(13, HIGH);  // Turn LED ON
  delay(1000);               // Wait 1 second
  digitalWrite(13, LOW);   // Turn LED OFF
  delay(1000);               // Wait 1 second
}`,
    challenge: "Can you make the LED blink faster? Try changing 1000 to 200. What about making it blink in a pattern â€” like SOS in Morse code (3 short, 3 long, 3 short)?",
    science: "When electricity flows through an LED, it produces light. The resistor limits the current so the LED doesn't burn out â€” think of it like a speed bump for electrons!",
    diagram:{width:600,height:300,components:[{type:"arduino",x:50,y:50},{type:"resistor",x:320,y:80,label:"220Î©"},{type:"led",x:420,y:80,color:"#22c55e",label:"LED"}],wires:[{from:[180,80],to:[320,80],color:"#ef4444",label:"Pin 13"},{from:[380,80],to:[420,80],color:"#f97316"},{from:[460,80],to:[460,200],color:"#333"},{from:[460,200],to:[180,200],color:"#333",label:"GND"}]},
    wokwiUrl: "https://wokwi.com/projects/new/arduino-uno"
  },
  {
    id: 2,
    title: "Traffic Light",
    subtitle: "Control 3 LEDs in sequence",
    icon: "ðŸš¦",
    difficulty: 1,
    category: "Basics",
    color: "#ef4444",
    time: "25 min",
    questTitle: "The City's Main Intersection is Chaos!",
    questIntro: "Traffic is out of control! Build a traffic light to restore order to Spark City's streets.",
    systemRepaired: "Traffic Control",
    components: ["Arduino Uno", "Breadboard", "1 Red LED", "1 Yellow LED", "1 Green LED", "3 Resistors (220Î©)", "7 Jumper wires"],
    learn: ["Using multiple output pins", "Sequencing with delays", "How real traffic lights work"],
    description: "Build a miniature traffic light that cycles through red, yellow, and green â€” just like the ones on the street!",
    wiring: [
      { from: "Arduino Pin 4", to: "Resistor â†’ Red LED â†’ GND", note: "Red light" },
      { from: "Arduino Pin 3", to: "Resistor â†’ Yellow LED â†’ GND", note: "Yellow light" },
      { from: "Arduino Pin 2", to: "Resistor â†’ Green LED â†’ GND", note: "Green light" }
    ],
    code: `// Project 2: Traffic Light
int red = 4;
int yellow = 3;
int green = 2;

void setup() {
  pinMode(red, OUTPUT);
  pinMode(yellow, OUTPUT);
  pinMode(green, OUTPUT);
}

void loop() {
  // Green ON for 5 seconds
  digitalWrite(green, HIGH);
  delay(5000);
  digitalWrite(green, LOW);

  // Yellow ON for 2 seconds
  digitalWrite(yellow, HIGH);
  delay(2000);
  digitalWrite(yellow, LOW);

  // Red ON for 5 seconds
  digitalWrite(red, HIGH);
  delay(5000);
  digitalWrite(red, LOW);
}`,
    challenge: "Add a pedestrian button! Connect a push button and make the light turn red when someone presses it. Hint: you'll need digitalRead().",
    science: "Traffic lights use timers and sensors to manage the flow of cars. Some smart traffic lights use cameras and AI to detect how many cars are waiting!",
    diagram:{width:600,height:300,components:[{type:"arduino",x:50,y:50},{type:"led",x:350,y:40,color:"#ef4444",label:"Red"},{type:"led",x:350,y:120,color:"#eab308",label:"Yellow"},{type:"led",x:350,y:200,color:"#22c55e",label:"Green"},{type:"resistor",x:280,y:40,label:"220Î©"},{type:"resistor",x:280,y:120,label:"220Î©"},{type:"resistor",x:280,y:200,label:"220Î©"}],wires:[{from:[180,70],to:[280,40],color:"#ef4444",label:"Pin 4"},{from:[180,90],to:[280,120],color:"#eab308",label:"Pin 3"},{from:[180,110],to:[280,200],color:"#22c55e",label:"Pin 2"},{from:[390,40],to:[450,40],color:"#333"},{from:[390,120],to:[450,120],color:"#333"},{from:[390,200],to:[450,200],color:"#333"},{from:[450,40],to:[450,250],color:"#333",label:"GND"}]},
    wokwiUrl: "https://wokwi.com/projects/new/arduino-uno"
  },
  {
    id: 3,
    title: "Piano Keys",
    subtitle: "Make music with a buzzer",
    icon: "ðŸŽ¹",
    difficulty: 2,
    category: "Sound",
    color: "#a855f7",
    time: "30 min",
    questTitle: "Sparky's Voice Module is Damaged!",
    questIntro: "Sparky can't speak! Wire up a buzzer so our robot friend can communicate with Spark City again.",
    systemRepaired: "Voice Module",
    components: ["Arduino Uno", "Breadboard", "Piezo Buzzer", "4 Push Buttons", "4 Resistors (10kÎ©)", "Jumper wires"],
    learn: ["Reading button inputs", "Generating sound frequencies", "The tone() function"],
    description: "Build a 4-key piano! Press different buttons to play different musical notes through a buzzer.",
    wiring: [
      { from: "Buzzer (+)", to: "Arduino Pin 8", note: "Sound output pin" },
      { from: "Buzzer (âˆ’)", to: "GND", note: "" },
      { from: "Buttons", to: "Pins 2, 3, 4, 5", note: "Each button connects to a pin AND to GND through a 10kÎ© resistor" }
    ],
    code: `// Project 3: Piano Keys
int buzzer = 8;
int buttons[] = {2, 3, 4, 5};
int notes[] = {262, 330, 392, 523}; // C, E, G, C5

void setup() {
  for(int i = 0; i < 4; i++) {
    pinMode(buttons[i], INPUT_PULLUP);
  }
}

void loop() {
  bool played = false;
  for(int i = 0; i < 4; i++) {
    if(digitalRead(buttons[i]) == LOW) {
      tone(buzzer, notes[i]);
      played = true;
    }
  }
  if(!played) noTone(buzzer);
}`,
    challenge: "Can you play a song? Try making the Arduino play \"Twinkle Twinkle Little Star\" automatically using tone() and delay(). The notes are: C C G G A A G, F F E E D D C.",
    science: "Sound is made by vibrations. The buzzer vibrates the air at different speeds (frequencies) to make different pitches. Middle C vibrates 262 times per second!",
    diagram:{width:600,height:300,components:[{type:"arduino",x:50,y:50},{type:"buzzer",x:400,y:50,label:"Buzzer"},{type:"button",x:300,y:140,label:"Btn 1"},{type:"button",x:370,y:140,label:"Btn 2"},{type:"button",x:440,y:140,label:"Btn 3"},{type:"button",x:510,y:140,label:"Btn 4"}],wires:[{from:[180,80],to:[400,50],color:"#a855f7",label:"Pin 8"},{from:[180,90],to:[300,140],color:"#3b82f6",label:"Pin 2"},{from:[180,100],to:[370,140],color:"#22c55e",label:"Pin 3"},{from:[180,110],to:[440,140],color:"#eab308",label:"Pin 4"},{from:[180,120],to:[510,140],color:"#f97316",label:"Pin 5"}]},
    wokwiUrl: "https://wokwi.com/projects/new/arduino-uno"
  },
  {
    id: 4,
    title: "Night Light",
    subtitle: "Auto-sensing darkness",
    icon: "ðŸŒ™",
    difficulty: 2,
    category: "Sensors",
    color: "#eab308",
    time: "25 min",
    questTitle: "The City's Street Lights are Dead!",
    questIntro: "Spark City is dark at night! Build a sensor that turns lights on automatically when it's dark.",
    systemRepaired: "Street Lights",
    components: ["Arduino Uno", "Breadboard", "Photoresistor (LDR)", "1 LED", "1 Resistor (220Î©)", "1 Resistor (10kÎ©)", "Jumper wires"],
    learn: ["Analog input reading", "Light sensors", "Threshold-based decisions", "Serial Monitor"],
    description: "Build a smart night light that turns on automatically when the room gets dark â€” just like real street lights!",
    wiring: [
      { from: "Photoresistor", to: "5V and Analog Pin A0", note: "One leg to 5V, other leg to A0" },
      { from: "10kÎ© Resistor", to: "A0 and GND", note: "This creates a voltage divider" },
      { from: "Pin 9 â†’ 220Î© Resistor â†’ LED â†’ GND", to: "", note: "Output LED circuit" }
    ],
    code: `// Project 4: Night Light
int lightSensor = A0;
int ledPin = 9;
int threshold = 400;  // Adjust this value!

void setup() {
  pinMode(ledPin, OUTPUT);
  Serial.begin(9600);  // Start Serial Monitor
}

void loop() {
  int lightLevel = analogRead(lightSensor);
  Serial.print("Light: ");
  Serial.println(lightLevel);

  if(lightLevel < threshold) {
    digitalWrite(ledPin, HIGH);  // Dark â†’ LED ON
  } else {
    digitalWrite(ledPin, LOW);   // Bright â†’ LED OFF
  }
  delay(100);
}`,
    challenge: "Instead of just ON/OFF, can you make the LED gradually get brighter as it gets darker? Hint: use analogWrite() and the map() function!",
    science: "A photoresistor changes its resistance based on light. In the dark, its resistance is high (millions of ohms). In bright light, it drops to just hundreds of ohms!",
    diagram:{width:600,height:300,components:[{type:"arduino",x:50,y:50},{type:"sensor",x:350,y:60,label:"LDR"},{type:"resistor",x:350,y:130,label:"10kÎ©"},{type:"led",x:450,y:200,color:"#eab308",label:"LED"},{type:"resistor",x:380,y:200,label:"220Î©"}],wires:[{from:[180,160],to:[350,60],color:"#06b6d4",label:"A0"},{from:[350,100],to:[350,130],color:"#06b6d4"},{from:[180,100],to:[380,200],color:"#f97316",label:"Pin 9"},{from:[420,200],to:[450,200],color:"#f97316"},{from:[490,200],to:[490,260],color:"#333",label:"GND"}]},
    wokwiUrl: "https://wokwi.com/projects/new/arduino-uno"
  },
  {
    id: 5,
    title: "Distance Detector",
    subtitle: "Ultrasonic range finder",
    icon: "ðŸ“¡",
    difficulty: 2,
    category: "Sensors",
    color: "#06b6d4",
    time: "30 min",
    questTitle: "Sparky Keeps Bumping Into Walls!",
    questIntro: "Give Sparky eyes that can measure distance to avoid obstacles. Build an ultrasonic sensor!",
    systemRepaired: "Distance Sensor",
    components: ["Arduino Uno", "Breadboard", "HC-SR04 Ultrasonic Sensor", "Piezo Buzzer", "Jumper wires"],
    learn: ["How ultrasonic sensors work", "Measuring distance", "Speed of sound", "Mapping values"],
    description: "Build a parking sensor! It beeps faster as objects get closer â€” just like the one in a car's bumper.",
    wiring: [
      { from: "HC-SR04 VCC", to: "Arduino 5V", note: "Power the sensor" },
      { from: "HC-SR04 Trig", to: "Arduino Pin 9", note: "Trigger sends the sound pulse" },
      { from: "HC-SR04 Echo", to: "Arduino Pin 10", note: "Echo receives the bounce-back" },
      { from: "HC-SR04 GND", to: "Arduino GND", note: "" },
      { from: "Buzzer", to: "Pin 8 and GND", note: "Warning beeper" }
    ],
    code: `// Project 5: Distance Detector
int trigPin = 9;
int echoPin = 10;
int buzzer = 8;

void setup() {
  pinMode(trigPin, OUTPUT);
  pinMode(echoPin, INPUT);
  pinMode(buzzer, OUTPUT);
  Serial.begin(9600);
}

void loop() {
  // Send ultrasonic pulse
  digitalWrite(trigPin, LOW);
  delayMicroseconds(2);
  digitalWrite(trigPin, HIGH);
  delayMicroseconds(10);
  digitalWrite(trigPin, LOW);

  // Measure echo time
  long duration = pulseIn(echoPin, HIGH);
  int distance = duration * 0.034 / 2; // cm

  Serial.print("Distance: ");
  Serial.print(distance);
  Serial.println(" cm");

  // Beep faster when closer
  if(distance < 30) {
    int beepDelay = map(distance, 0, 30, 50, 500);
    tone(buzzer, 1000, 50);
    delay(beepDelay);
  }
  delay(50);
}`,
    challenge: "Add 3 LEDs (green, yellow, red) that light up based on distance: green for far, yellow for medium, red for close. Like a real parking sensor display!",
    science: "Bats use the same trick! They send out sound pulses and listen for echoes. By timing how long the echo takes, they know how far away things are. This is called echolocation.",
    diagram:{width:600,height:300,components:[{type:"arduino",x:50,y:50},{type:"sensor",x:350,y:50,label:"HC-SR04"},{type:"buzzer",x:450,y:180,label:"Buzzer"}],wires:[{from:[180,80],to:[350,50],color:"#ef4444",label:"Trigâ†’9"},{from:[180,90],to:[350,80],color:"#3b82f6",label:"Echoâ†’10"},{from:[180,100],to:[450,180],color:"#a855f7",label:"Pin 8"},{from:[350,110],to:[350,260],color:"#333",label:"GND"},{from:[350,40],to:[350,20],color:"#ef4444",label:"5V"}]},
    wokwiUrl: "https://wokwi.com/projects/new/arduino-uno"
  },
  {
    id: 6,
    title: "Thermometer",
    subtitle: "Digital temperature display",
    icon: "ðŸŒ¡ï¸",
    difficulty: 2,
    category: "Sensors",
    color: "#f97316",
    time: "30 min",
    questTitle: "The Power Plant is Overheating!",
    questIntro: "Spark City's power station needs monitoring. Build a thermometer to track the temperature before it overheats!",
    systemRepaired: "Temperature Monitor",
    components: ["Arduino Uno", "Breadboard", "TMP36 Temperature Sensor", "16x2 LCD Display (with I2C)", "Jumper wires"],
    learn: ["Temperature sensors", "Analog-to-temperature conversion", "LCD displays", "Real-world data"],
    description: "Build your own digital thermometer that shows the current temperature on an LCD screen!",
    wiring: [
      { from: "TMP36 left pin", to: "5V", note: "Power (flat side facing you)" },
      { from: "TMP36 middle pin", to: "Analog A0", note: "Signal output" },
      { from: "TMP36 right pin", to: "GND", note: "Ground" },
      { from: "LCD SDA", to: "Arduino A4", note: "I2C data line" },
      { from: "LCD SCL", to: "Arduino A5", note: "I2C clock line" }
    ],
    code: `// Project 6: Thermometer
// If using I2C LCD, install LiquidCrystal_I2C library
#include &lt;Wire.h&gt;
#include &lt;LiquidCrystal_I2C.h&gt;

LiquidCrystal_I2C lcd(0x27, 16, 2);
int tempPin = A0;

void setup() {
  lcd.init();
  lcd.backlight();
  lcd.print("Thermometer");
  delay(2000);
}

void loop() {
  int reading = analogRead(tempPin);
  float voltage = reading * 5.0 / 1024.0;
  float tempC = (voltage - 0.5) * 100.0;
  float tempF = tempC * 9.0/5.0 + 32.0;

  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("Temp: ");
  lcd.print(tempC, 1);
  lcd.print(" C");
  lcd.setCursor(0, 1);
  lcd.print("      ");
  lcd.print(tempF, 1);
  lcd.print(" F");
  delay(1000);
}`,
    challenge: "Add a warning buzzer that beeps when the temperature goes above a certain limit. You could also add colored LEDs: blue for cold, green for comfortable, red for hot!",
    science: "The TMP36 sensor uses a special property of semiconductors: as temperature changes, the voltage it outputs changes by exactly 10 millivolts per degree Celsius.",
    diagram:{width:600,height:300,components:[{type:"arduino",x:50,y:50},{type:"sensor",x:320,y:50,label:"TMP36"},{type:"sensor",x:400,y:170,label:"LCD I2C"}],wires:[{from:[180,160],to:[320,50],color:"#06b6d4",label:"A0"},{from:[180,170],to:[400,170],color:"#22c55e",label:"SDAâ†’A4"},{from:[180,180],to:[400,200],color:"#3b82f6",label:"SCLâ†’A5"},{from:[320,80],to:[320,260],color:"#333",label:"GND"},{from:[320,40],to:[320,20],color:"#ef4444",label:"5V"}]},
    wokwiUrl: "https://wokwi.com/projects/new/arduino-uno"
  },
  {
    id: 7,
    title: "IR Remote Control",
    subtitle: "Control LEDs with a remote",
    icon: "ðŸ“º",
    difficulty: 3,
    category: "Communication",
    color: "#ec4899",
    time: "35 min",
    questTitle: "We Need Remote Control for Spark City!",
    questIntro: "Build an IR receiver so we can control Spark City's systems from a distance. Every hero needs a remote control!",
    systemRepaired: "Remote Control",
    components: ["Arduino Uno", "Breadboard", "IR Receiver Module", "IR Remote Control", "3 LEDs", "3 Resistors (220Î©)", "Jumper wires"],
    learn: ["Infrared communication", "Decoding signals", "Using libraries", "Switch/case logic"],
    description: "Use your TV-style remote control to command your Arduino! Press different buttons to control different LEDs.",
    wiring: [
      { from: "IR Receiver Signal", to: "Arduino Pin 11", note: "Data output from receiver" },
      { from: "IR Receiver VCC", to: "5V", note: "" },
      { from: "IR Receiver GND", to: "GND", note: "" },
      { from: "LEDs", to: "Pins 2, 3, 4 with resistors", note: "Red, Green, Blue LEDs" }
    ],
    code: `// Project 7: IR Remote Control
// Install IRremote library from Library Manager
#include &lt;IRremote.h&gt;

int RECV_PIN = 11;
int leds[] = {2, 3, 4};

void setup() {
  Serial.begin(9600);
  IrReceiver.begin(RECV_PIN);
  for(int i = 0; i < 3; i++)
    pinMode(leds[i], OUTPUT);
  Serial.println("Ready! Press remote buttons...");
}

void loop() {
  if(IrReceiver.decode()) {
    unsigned long code = IrReceiver.decodedIRData.decodedRawData;
    Serial.println(code, HEX);

    // Map your remote's button codes here!
    // First: run this and press buttons to see codes
    // Then: replace these example codes with yours
    switch(code) {
      case 0xFFA25D:  // Button 1
        digitalWrite(leds[0], !digitalRead(leds[0]));
        break;
      case 0xFF629D:  // Button 2
        digitalWrite(leds[1], !digitalRead(leds[1]));
        break;
      case 0xFFE21D:  // Button 3
        digitalWrite(leds[2], !digitalRead(leds[2]));
        break;
    }
    IrReceiver.resume();
  }
}`,
    challenge: "Decode ALL the buttons on your remote and build a full LED light show controller. Add fade effects using analogWrite() for button presses!",
    science: "Infrared light is invisible to our eyes but not to electronics! Your TV remote sends pulses of IR light in specific patterns. Each button has a unique code, like a secret handshake.",
    diagram:{width:600,height:300,components:[{type:"arduino",x:50,y:50},{type:"sensor",x:350,y:50,label:"IR Recv"},{type:"led",x:400,y:150,color:"#ef4444",label:"Red"},{type:"led",x:450,y:150,color:"#22c55e",label:"Green"},{type:"led",x:500,y:150,color:"#3b82f6",label:"Blue"}],wires:[{from:[180,100],to:[350,50],color:"#ec4899",label:"Pin 11"},{from:[180,90],to:[400,150],color:"#ef4444",label:"Pin 2"},{from:[180,100],to:[450,150],color:"#22c55e",label:"Pin 3"},{from:[180,110],to:[500,150],color:"#3b82f6",label:"Pin 4"}]},
    wokwiUrl: "https://wokwi.com/projects/new/arduino-uno"
  },
  {
    id: 8,
    title: "Mood Lamp",
    subtitle: "RGB color mixing",
    icon: "ðŸŒˆ",
    difficulty: 2,
    category: "Creative",
    color: "#8b5cf6",
    time: "25 min",
    questTitle: "The City Park Needs Colors for the Festival!",
    questIntro: "Create a beautiful rainbow mood lamp for Spark City's festival. Make the park come alive with color!",
    systemRepaired: "City Lights",
    components: ["Arduino Uno", "Breadboard", "1 RGB LED (common cathode)", "3 Resistors (220Î©)", "1 Potentiometer (optional)", "Jumper wires"],
    learn: ["PWM (Pulse Width Modulation)", "Color mixing with RGB", "analogWrite()", "Smooth transitions"],
    description: "Create a lamp that smoothly fades through every color of the rainbow! RGB LEDs mix red, green, and blue light to create any color.",
    wiring: [
      { from: "RGB LED Red pin", to: "Pin 9 through 220Î© resistor", note: "" },
      { from: "RGB LED Green pin", to: "Pin 10 through 220Î© resistor", note: "" },
      { from: "RGB LED Blue pin", to: "Pin 11 through 220Î© resistor", note: "" },
      { from: "RGB LED longest pin (cathode)", to: "GND", note: "Common ground" }
    ],
    code: `// Project 8: Mood Lamp â€” Rainbow Fade
int redPin = 9;
int greenPin = 10;
int bluePin = 11;

void setup() {
  pinMode(redPin, OUTPUT);
  pinMode(greenPin, OUTPUT);
  pinMode(bluePin, OUTPUT);
}

void setColor(int r, int g, int b) {
  analogWrite(redPin, r);
  analogWrite(greenPin, g);
  analogWrite(bluePin, b);
}

void loop() {
  // Fade through rainbow colors
  for(int i = 0; i < 256; i++) {
    setColor(255-i, i, 0);  // Red â†’ Green
    delay(10);
  }
  for(int i = 0; i < 256; i++) {
    setColor(0, 255-i, i);  // Green â†’ Blue
    delay(10);
  }
  for(int i = 0; i < 256; i++) {
    setColor(i, 0, 255-i);  // Blue â†’ Red
    delay(10);
  }
}`,
    challenge: "Add a potentiometer to control the speed of the color change! Or add a button that freezes on your favorite color.",
    science: "Your eyes have 3 types of color receptors: red, green, and blue. By mixing these 3 colors of light at different brightnesses, we can trick your eyes into seeing any color!",
    diagram:{width:600,height:300,components:[{type:"arduino",x:50,y:50},{type:"led",x:400,y:100,color:"linear-gradient(#ef4444,#22c55e,#3b82f6)",label:"RGB LED"},{type:"resistor",x:300,y:70,label:"220Î©"},{type:"resistor",x:300,y:110,label:"220Î©"},{type:"resistor",x:300,y:150,label:"220Î©"}],wires:[{from:[180,90],to:[300,70],color:"#ef4444",label:"Pin 9 (R)"},{from:[180,100],to:[300,110],color:"#22c55e",label:"Pin 10 (G)"},{from:[180,110],to:[300,150],color:"#3b82f6",label:"Pin 11 (B)"},{from:[440,130],to:[440,260],color:"#333",label:"GND"}]},
    wokwiUrl: "https://wokwi.com/projects/new/arduino-uno"
  },
  {
    id: 9,
    title: "Servo Sweeper",
    subtitle: "Motorized movement",
    icon: "ðŸ¦¾",
    difficulty: 2,
    category: "Motors",
    color: "#14b8a6",
    time: "20 min",
    questTitle: "Sparky's Arm is Stuck!",
    questIntro: "Fix Sparky's servo motor so our robot can move and gesture to the citizens of Spark City!",
    systemRepaired: "Servo Motor",
    components: ["Arduino Uno", "Servo Motor (SG90)", "1 Potentiometer", "Jumper wires"],
    learn: ["Servo motor control", "The Servo library", "Mapping analog input to angles", "Mechanical movement"],
    description: "Control a servo motor with a dial! Turn the potentiometer and watch the servo follow your exact position.",
    wiring: [
      { from: "Servo Orange wire", to: "Arduino Pin 9", note: "Signal/control wire" },
      { from: "Servo Red wire", to: "5V", note: "Power" },
      { from: "Servo Brown wire", to: "GND", note: "Ground" },
      { from: "Potentiometer", to: "5V, A0, GND", note: "Leftâ†’5V, Middleâ†’A0, Rightâ†’GND" }
    ],
    code: `// Project 9: Servo Sweeper
#include &lt;Servo.h&gt;

Servo myServo;
int potPin = A0;

void setup() {
  myServo.attach(9);
  Serial.begin(9600);
}

void loop() {
  int potValue = analogRead(potPin);
  int angle = map(potValue, 0, 1023, 0, 180);

  myServo.write(angle);

  Serial.print("Angle: ");
  Serial.println(angle);
  delay(15);
}`,
    challenge: "Build a mini radar! Mount the ultrasonic sensor on the servo, sweep it back and forth, and print distance readings for each angle. You've built a real radar scanner!",
    science: "Servo motors have a special feedback circuit inside that knows their exact position. Unlike regular motors that just spin, servos can hold a precise angle â€” that's why robots use them for joints!",
    diagram:{width:600,height:300,components:[{type:"arduino",x:50,y:50},{type:"sensor",x:350,y:50,label:"Servo SG90"},{type:"sensor",x:350,y:180,label:"Potentiometer"}],wires:[{from:[180,90],to:[350,50],color:"#f97316",label:"Pin 9"},{from:[350,80],to:[350,100],color:"#ef4444",label:"5V"},{from:[350,100],to:[350,120],color:"#333",label:"GND"},{from:[180,160],to:[350,180],color:"#06b6d4",label:"A0"}]},
    wokwiUrl: "https://wokwi.com/projects/new/arduino-uno"
  },
  {
    id: 10,
    title: "Intruder Alarm",
    subtitle: "Motion-triggered security",
    icon: "ðŸš¨",
    difficulty: 3,
    category: "Sensors",
    color: "#ef4444",
    time: "35 min",
    questTitle: "Someone's Sneaking Into the Power Plant!",
    questIntro: "Build a security system to protect Spark City from intruders. Defend the power plant with alarms and sensors!",
    systemRepaired: "Security System",
    components: ["Arduino Uno", "Breadboard", "HC-SR04 Ultrasonic Sensor", "Piezo Buzzer", "1 Red LED", "1 Green LED", "2 Resistors (220Î©)", "1 Push Button", "Jumper wires"],
    learn: ["Security system logic", "State machines", "Armed/disarmed modes", "Combining multiple components"],
    description: "Build a real security system! Arm it with a button, and if anyone gets too close, the alarm goes off with flashing lights and sirens.",
    wiring: [
      { from: "HC-SR04", to: "Trigâ†’Pin 9, Echoâ†’Pin 10", note: "Distance sensor" },
      { from: "Buzzer", to: "Pin 8", note: "Alarm sound" },
      { from: "Red LED", to: "Pin 4 with resistor", note: "Alarm indicator" },
      { from: "Green LED", to: "Pin 3 with resistor", note: "Armed indicator" },
      { from: "Button", to: "Pin 2 with INPUT_PULLUP", note: "Arm/disarm toggle" }
    ],
    code: `// Project 10: Intruder Alarm
int trigPin = 9, echoPin = 10;
int buzzer = 8, redLed = 4, greenLed = 3;
int button = 2;
bool armed = false, alarm = false;
int baseDistance = 0;

int getDistance() {
  digitalWrite(trigPin, LOW);
  delayMicroseconds(2);
  digitalWrite(trigPin, HIGH);
  delayMicroseconds(10);
  digitalWrite(trigPin, LOW);
  return pulseIn(echoPin, HIGH) * 0.034 / 2;
}

void setup() {
  pinMode(trigPin, OUTPUT);
  pinMode(echoPin, INPUT);
  pinMode(buzzer, OUTPUT);
  pinMode(redLed, OUTPUT);
  pinMode(greenLed, OUTPUT);
  pinMode(button, INPUT_PULLUP);
  Serial.begin(9600);
}

void loop() {
  // Toggle armed state with button
  if(digitalRead(button) == LOW) {
    armed = !armed;
    alarm = false;
    if(armed) {
      baseDistance = getDistance();
      Serial.println("ARMED!");
      tone(buzzer, 1000, 200);
    } else {
      Serial.println("Disarmed");
      noTone(buzzer);
    }
    delay(500);
  }

  digitalWrite(greenLed, armed);

  if(armed && !alarm) {
    int dist = getDistance();
    if(abs(dist - baseDistance) > 15) {
      alarm = true;
      Serial.println("*** INTRUDER! ***");
    }
  }

  if(alarm) {
    digitalWrite(redLed, HIGH);
    tone(buzzer, 2000, 100);
    delay(100);
    digitalWrite(redLed, LOW);
    tone(buzzer, 1500, 100);
    delay(100);
  }
  delay(50);
}`,
    challenge: "Add a 10-second countdown when you arm it (like a real alarm system). Show the countdown on the Serial Monitor and beep each second!",
    science: "Real security systems use a combination of sensors: infrared motion detectors, magnetic door contacts, glass break sensors, and cameras â€” all connected to a central brain, just like your Arduino!",
    diagram:{width:600,height:300,components:[{type:"arduino",x:50,y:50},{type:"sensor",x:330,y:40,label:"HC-SR04"},{type:"buzzer",x:430,y:40,label:"Buzzer"},{type:"led",x:330,y:140,color:"#ef4444",label:"Red LED"},{type:"led",x:430,y:140,color:"#22c55e",label:"Green LED"},{type:"button",x:330,y:220,label:"Arm Btn"}],wires:[{from:[180,80],to:[330,40],color:"#ef4444",label:"Trigâ†’9"},{from:[180,90],to:[330,60],color:"#3b82f6",label:"Echoâ†’10"},{from:[180,100],to:[430,40],color:"#a855f7",label:"Pin 8"},{from:[180,110],to:[330,140],color:"#ef4444",label:"Pin 4"},{from:[180,120],to:[430,140],color:"#22c55e",label:"Pin 3"},{from:[180,130],to:[330,220],color:"#eab308",label:"Pin 2"}]},
    wokwiUrl: "https://wokwi.com/projects/new/arduino-uno"
  },
  {
    id: 11,
    title: "Weather Station",
    subtitle: "Multi-sensor data logger",
    icon: "â›…",
    difficulty: 3,
    category: "Advanced",
    color: "#0ea5e9",
    time: "45 min",
    questTitle: "Spark City Needs Weather Forecasting!",
    questIntro: "Build a multi-sensor weather station so citizens can plan their day. Monitor temperature and light for the city!",
    systemRepaired: "Weather System",
    components: ["Arduino Uno", "TMP36 Temperature Sensor", "Photoresistor", "16x2 LCD (I2C)", "Resistor (10kÎ©)", "Breadboard", "Jumper wires"],
    learn: ["Combining multiple sensors", "Data display", "Real-time monitoring", "Scientific measurement"],
    description: "Build a mini weather station that monitors temperature and light levels, showing live data on an LCD screen â€” your personal environmental dashboard!",
    wiring: [
      { from: "TMP36", to: "5V, A0, GND", note: "Temperature sensor" },
      { from: "Photoresistor + 10kÎ©", to: "A1 voltage divider", note: "Light level" },
      { from: "LCD I2C", to: "SDAâ†’A4, SCLâ†’A5", note: "Display" }
    ],
    code: `// Project 11: Weather Station
#include &lt;Wire.h&gt;
#include &lt;LiquidCrystal_I2C.h&gt;

LiquidCrystal_I2C lcd(0x27, 16, 2);

void setup() {
  lcd.init();
  lcd.backlight();
  Serial.begin(9600);
  lcd.print("Weather Station");
  delay(2000);
}

void loop() {
  // Read temperature
  float voltage = analogRead(A0) * 5.0 / 1024.0;
  float tempC = (voltage - 0.5) * 100.0;

  // Read light level
  int light = analogRead(A1);
  String brightness;
  if(light > 800) brightness = "Sunny";
  else if(light > 400) brightness = "Cloudy";
  else brightness = "Dark";

  lcd.clear();
  lcd.setCursor(0, 0);
  lcd.print("Temp: ");
  lcd.print(tempC, 1);
  lcd.print("C");
  lcd.setCursor(0, 1);
  lcd.print("Light: ");
  lcd.print(brightness);

  // Also log to Serial for graphing
  Serial.print(tempC);
  Serial.print(",");
  Serial.println(light);

  delay(2000);
}`,
    challenge: "Use the Serial Plotter in Arduino IDE to graph your temperature over time! Leave it running for an hour and see how temperature changes. Can you spot when someone opens a window?",
    science: "Real weather stations measure many things: temperature, humidity, air pressure, wind speed, rainfall, UV index, and more. Satellites orbiting Earth have weather stations that look down at the whole planet!",
    diagram:{width:600,height:300,components:[{type:"arduino",x:50,y:50},{type:"sensor",x:320,y:40,label:"TMP36"},{type:"sensor",x:420,y:40,label:"LDR"},{type:"sensor",x:370,y:170,label:"LCD I2C"}],wires:[{from:[180,160],to:[320,40],color:"#06b6d4",label:"A0"},{from:[180,165],to:[420,40],color:"#22c55e",label:"A1"},{from:[180,170],to:[370,170],color:"#eab308",label:"SDAâ†’A4"},{from:[180,180],to:[370,200],color:"#f97316",label:"SCLâ†’A5"}]},
    wokwiUrl: "https://wokwi.com/projects/new/arduino-uno"
  },
  {
    id: 12,
    title: "Robot Car Basics",
    subtitle: "Your first moving robot",
    icon: "ðŸ¤–",
    difficulty: 3,
    category: "Robotics",
    color: "#f59e0b",
    time: "60 min",
    questTitle: "Sparky is Fully Repaired! Build Their Vehicle!",
    questIntro: "The grand finale! Sparky is fixed and ready to patrol Spark City. Build a robot car with obstacle avoidance to complete the mission!",
    systemRepaired: "Sparky Vehicle",
    components: ["Arduino Uno", "L298N Motor Driver", "2 DC Motors", "Robot chassis/wheels", "Battery pack (4xAA or 9V)", "HC-SR04 Ultrasonic Sensor", "Jumper wires"],
    learn: ["DC motor control", "H-bridge motor drivers", "Autonomous navigation", "Obstacle avoidance"],
    description: "The grand finale! Build a robot car that drives around and avoids obstacles on its own. This combines everything you've learned into one awesome project!",
    wiring: [
      { from: "L298N IN1, IN2", to: "Arduino Pins 5, 6", note: "Left motor control" },
      { from: "L298N IN3, IN4", to: "Arduino Pins 9, 10", note: "Right motor control" },
      { from: "L298N ENA, ENB", to: "Pins 3, 11 (PWM)", note: "Speed control" },
      { from: "L298N 12V", to: "Battery pack +", note: "Motor power (separate!)" },
      { from: "HC-SR04", to: "Trigâ†’7, Echoâ†’8", note: "Front-facing distance sensor" }
    ],
    code: `// Project 12: Robot Car with Obstacle Avoidance
// Motor pins
int IN1=5, IN2=6, IN3=9, IN4=10;
int ENA=3, ENB=11;
int trigPin=7, echoPin=8;
int speed = 150; // 0-255

int getDistance() {
  digitalWrite(trigPin, LOW);
  delayMicroseconds(2);
  digitalWrite(trigPin, HIGH);
  delayMicroseconds(10);
  digitalWrite(trigPin, LOW);
  return pulseIn(echoPin, HIGH) * 0.034 / 2;
}

void forward()  { analogWrite(ENA,speed); analogWrite(ENB,speed);
  digitalWrite(IN1,HIGH); digitalWrite(IN2,LOW);
  digitalWrite(IN3,HIGH); digitalWrite(IN4,LOW); }

void turnRight() { analogWrite(ENA,speed); analogWrite(ENB,speed);
  digitalWrite(IN1,HIGH); digitalWrite(IN2,LOW);
  digitalWrite(IN3,LOW); digitalWrite(IN4,HIGH); }

void stopCar()  { analogWrite(ENA,0); analogWrite(ENB,0); }

void setup() {
  int pins[] = {IN1,IN2,IN3,IN4,ENA,ENB,trigPin};
  for(int p : pins) pinMode(p, OUTPUT);
  pinMode(echoPin, INPUT);
  Serial.begin(9600);
}

void loop() {
  int dist = getDistance();
  Serial.println(dist);

  if(dist > 20) {
    forward();
  } else {
    stopCar();
    delay(300);
    turnRight();
    delay(400);
  }
  delay(50);
}`,
    challenge: "Make the robot smarter! Add a servo to scan left and right before deciding which way to turn. Or add line-following sensors to make it follow a track made with black tape!",
    science: "Self-driving cars use the same basic idea but with much more powerful sensors: LIDAR (laser distance), cameras, GPS, and machine learning. Your robot is doing the same thing â€” just simpler!",
    diagram:{width:600,height:300,components:[{type:"arduino",x:50,y:50},{type:"sensor",x:350,y:30,label:"L298N Driver"},{type:"sensor",x:250,y:200,label:"Left Motor"},{type:"sensor",x:450,y:200,label:"Right Motor"},{type:"sensor",x:350,y:130,label:"HC-SR04"}],wires:[{from:[180,80],to:[350,30],color:"#ef4444",label:"IN1â†’5,IN2â†’6"},{from:[180,90],to:[350,50],color:"#3b82f6",label:"IN3â†’9,IN4â†’10"},{from:[180,100],to:[350,130],color:"#22c55e",label:"Trigâ†’7,Echoâ†’8"},{from:[350,60],to:[250,200],color:"#a855f7",label:"Motor A"},{from:[350,70],to:[450,200],color:"#f97316",label:"Motor B"}]},
    wokwiUrl: "https://wokwi.com/projects/new/arduino-uno"
  }
];

// â”€â”€â”€ DATA POOLS (Expanded) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const QUIZ_QUESTIONS = [
  // Original 15 questions
  { q: "What does LED stand for?", a: "Light Emitting Diode", wrong: ["Long Electronic Device", "Light Enabled Display", "Logical Electronic Device"] },
  { q: "Which pin types can read analog values on Arduino?", a: "A0-A5 pins", wrong: ["D0-D13 pins", "Digital pins only", "GND and 5V"] },
  { q: "What voltage does an Arduino Uno output?", a: "5V", wrong: ["3.3V", "12V", "9V"] },
  { q: "What does PWM stand for?", a: "Pulse Width Modulation", wrong: ["Power Wave Mode", "Pulse Width Monitor", "Programming With Modules"] },
  { q: "How many digital pins does Arduino Uno have?", a: "14", wrong: ["6", "8", "20"] },
  { q: "Which function sets a pin as input or output?", a: "pinMode()", wrong: ["setPin()", "pinMode()", "digitalMode()"] },
  { q: "What does a 10k ohm resistor look like?", a: "Brown-Black-Orange bands", wrong: ["Brown-Black-Red bands", "Red-Red-Red bands", "Orange-Orange-Orange bands"] },
  { q: "Which statement reads a digital pin?", a: "digitalRead()", wrong: ["readDigital()", "pinRead()", "getDigital()"] },
  { q: "How do you make an LED brighter with PWM?", a: "Increase the duty cycle (0-255)", wrong: ["Use a bigger resistor", "Add more LEDs", "Increase voltage to 12V"] },
  { q: "What is the purpose of a pull-up resistor?", a: "Keep a pin at HIGH when not pressed", wrong: ["Make LEDs brighter", "Protect from static electricity", "Reduce power consumption"] },
  { q: "What does Serial.begin(9600) do?", a: "Starts serial communication at 9600 baud", wrong: ["Begins a new serial device", "Sets the baud rate to 9600 Hz", "Initializes 9600 pins"] },
  { q: "Which pin should a button connect to?", a: "A digital pin with a pull-up resistor", wrong: ["Only analog pins", "5V directly", "GND directly"] },
  { q: "What is the delay() function used for?", a: "Pausing the program for milliseconds", wrong: ["Slowing down the computer", "Delaying serial output", "Creating loops"] },
  { q: "How many analog input pins does Arduino Uno have?", a: "6", wrong: ["4", "8", "12"] },
  { q: "What does digitalWrite(13, HIGH) do?", a: "Sends 5V to pin 13", wrong: ["Turns off pin 13", "Reads pin 13", "Sets pin 13 to input mode"] },

  // New 30 questions (difficulty balanced)
  { q: "What type of sensor measures temperature?", a: "Thermistor or DHT sensor", wrong: ["Light sensor", "Distance sensor", "Motion sensor"] },
  { q: "Which operator is used to check if two values are equal?", a: "==", wrong: ["=", "===", "!="] },
  { q: "What does analogRead() return?", a: "A value between 0-1023", wrong: ["0 or 1", "0-5 volts", "0-255"] },
  { q: "How do you turn an LED on completely with PWM?", a: "analogWrite(pin, 255)", wrong: ["analogWrite(pin, 0)", "digitalWrite(pin, 255)", "analogWrite(pin, 5)"] },
  { q: "What is a servo motor used for?", a: "Precise angle positioning (0-180 degrees)", wrong: ["Continuous spinning", "Linear motion", "Lifting heavy objects"] },
  { q: "How do you read a digital button press?", a: "digitalRead(buttonPin)", wrong: ["analogRead(buttonPin)", "readButton()", "getButton()"] },
  { q: "What does the setup() function do?", a: "Runs once when Arduino powers on", wrong: ["Runs continuously", "Sets up the internet", "Initializes sensors only"] },
  { q: "Which loop runs forever on Arduino?", a: "void loop()", wrong: ["void forever()", "void continuous()", "void repeat()"] },
  { q: "What is a breadboard used for?", a: "Prototyping circuits without soldering", wrong: ["Baking electronics", "Storing components", "Testing voltage"] },
  { q: "How do you write to Serial Monitor?", a: "Serial.println(value)", wrong: ["print(value)", "output(value)", "Serial.write()"] },
  { q: "What does a photoresistor (LDR) do?", a: "Changes resistance based on light", wrong: ["Detects motion", "Measures temperature", "Produces light"] },
  { q: "Which loop runs code a specific number of times?", a: "for loop", wrong: ["if loop", "when loop", "while loop"] },
  { q: "What is the range of analogWrite() values?", a: "0-255", wrong: ["0-1023", "0-5", "0-100"] },
  { q: "How do you connect an LED to Arduino safely?", a: "Through a current-limiting resistor", wrong: ["Directly to 5V", "Directly to power", "Without a resistor"] },
  { q: "What does an ultrasonic sensor measure?", a: "Distance using sound waves", wrong: ["Light intensity", "Temperature", "Humidity"] },
  { q: "What is the purpose of digitalWrite()?", a: "Send HIGH or LOW to a digital pin", wrong: ["Read a pin value", "Set analog values", "Configure pin modes"] },
  { q: "How do you create a comment in Arduino code?", a: "// or /* */", wrong: ["// only", "-- ", "# "] },
  { q: "What is a variable used for?", a: "Storing values that can change", wrong: ["Making circuits", "Controlling LEDs only", "Reading sensors only"] },
  { q: "Which statement repeats code while a condition is true?", a: "while loop", wrong: ["if statement", "for loop", "switch statement"] },
  { q: "What does map() function do?", a: "Converts values from one range to another", wrong: ["Creates a roadmap", "Displays a physical map", "Stores location data"] },
  { q: "How do you read an analog sensor value?", a: "analogRead(A0)", wrong: ["digitalRead(A0)", "readAnalog(A0)", "readValue(A0)"] },
  { q: "What is the purpose of the millis() function?", a: "Returns milliseconds since Arduino started", wrong: ["Returns current time of day", "Sets a timer", "Converts to milliseconds"] },
  { q: "How do you slow down a program?", a: "Use delay(milliseconds)", wrong: ["Use slow()", "Add more resistors", "Remove code"] },
  { q: "What type of motor can rotate continuously?", a: "DC motor", wrong: ["Servo motor", "Stepper motor", "Linear motor"] },
  { q: "Which sensor detects motion using infrared?", a: "PIR sensor", wrong: ["IR receiver", "Motion switch", "Pressure sensor"] },
  { q: "How do you initialize PWM on a pin?", a: "Use analogWrite(pin, value)", wrong: ["Use digitalWrite()", "Use pinMode() only", "No initialization needed"] },
  { q: "What does a relay do?", a: "Switches high-power devices using low-power signals", wrong: ["Reduces power consumption", "Amplifies signals", "Stores electrical charge"] },
  { q: "What is an interrupt used for?", a: "Respond immediately to events without polling", wrong: ["Stopping all code", "Creating delays", "Reading sensors"] },
  { q: "How do you make an Arduino project wireless?", a: "Add a WiFi or Bluetooth module", wrong: ["Use longer wires", "Add more batteries", "Change the code only"] },
  { q: "What does I2C communication do?", a: "Allows multiple devices to communicate using 2 wires", wrong: ["Uses 4 wires always", "Only for wireless", "Requires internet"] }
];

const DEBUG_CODE_SNIPPETS = [
  // Original 12 snippets
  {
    code: "void setup() {\n  pinMode(13, OUTPUT)\n  Serial.begin(9600)\n}",
    bugLine: 1,
    hint: "Check the end of each statement",
    answers: ["Line 1", "Line 2", "Line 3", "Line 4"]
  },
  {
    code: "int brightness = 100\nanalogWrite(13, brightness)\ndelay(1000)",
    bugLine: 0,
    hint: "Declarations need punctuation",
    answers: ["Line 1", "Line 2", "Line 3"]
  },
  {
    code: "void loop() {\n  if (buttonPin == HIGH) {\n    digitalWrite(ledPin, low)\n  }\n}",
    bugLine: 2,
    hint: "Look at the case of the keyword",
    answers: ["Line 1", "Line 2", "Line 3", "Line 4", "Line 5"]
  },
  {
    code: "for (int i = 0, i < 10, i++) {\n  Serial.println(i)\n}",
    bugLine: 0,
    hint: "Semicolons separate loop parts",
    answers: ["Line 1", "Line 2", "Line 3"]
  },
  {
    code: "int sensorValue = analogRead(A0)\nif (sensorValue > 512) {\n  digitalWrite(13, HIGH)\n}",
    bugLine: 0,
    hint: "Variable declarations need ending punctuation",
    answers: ["Line 1", "Line 2", "Line 3", "Line 4"]
  },
  {
    code: "pinMode(13, OUTPUT);\ndigitalWrite(13, HIGH)\nSerial.println(\"ON\");",
    bugLine: 1,
    hint: "Some lines are missing punctuation",
    answers: ["Line 1", "Line 2", "Line 3"]
  },
  {
    code: "int button = digitalRead(2)\nif (button = HIGH) {\n  digitalWrite(13, HIGH)\n}",
    bugLine: 1,
    hint: "Assignment vs comparison - what operator are we using?",
    answers: ["Line 1", "Line 2", "Line 3", "Line 4"]
  },
  {
    code: "int values[] = {10 20, 30, 40}\nfor (int i = 0; i < 4; i++) {\n  Serial.println(values[i])\n}",
    bugLine: 0,
    hint: "Array elements need separators",
    answers: ["Line 1", "Line 2", "Line 3", "Line 4"]
  },
  {
    code: "void setup() {\n  pinMode(13, INPUT);\n  digitalWrite(13, HIGH);\n}",
    bugLine: 1,
    hint: "What pin mode should this be?",
    answers: ["Line 1", "Line 2", "Line 3", "Line 4"]
  },
  {
    code: "delay(1000)\nSerial.println(\"1 second passed\");\ndigitalWrite(13, HIGH);",
    bugLine: 0,
    hint: "Function calls need ending punctuation",
    answers: ["Line 1", "Line 2"]
  },
  {
    code: "for (int i = 0; i < 5; i++)\n  Serial.println(i)\n  digitalWrite(13, HIGH);",
    bugLine: 1,
    hint: "Missing punctuation on this line",
    answers: ["Line 1", "Line 2", "Line 3"]
  },
  {
    code: "int x = 5\nint y = 10\nint sum = x + y\nSerial.println(sum);",
    bugLine: 0,
    hint: "Multiple lines missing ending marks",
    answers: ["Line 1", "Line 2", "Line 3", "Line 4"]
  },

  // New 24 snippets
  {
    code: "void loop() {\n  int sensor = analogRead(A0)\n  Serial.println(sensor);\n}",
    bugLine: 1,
    hint: "All variable declarations need semicolons",
    answers: ["Line 1", "Line 2", "Line 3", "Line 4"]
  },
  {
    code: "if (digitalRead(2) == high) {\n  digitalWrite(13, HIGH);\n}",
    bugLine: 0,
    hint: "Keywords need proper capitalization",
    answers: ["Line 1", "Line 2", "Line 3"]
  },
  {
    code: "int brightness[]\n  {0, 50, 100, 150, 200, 255}\nanalogWrite(13, brightness[3]);",
    bugLine: 0,
    hint: "Array declaration incomplete",
    answers: ["Line 1", "Line 2", "Line 3"]
  },
  {
    code: "void setup() {\n  Serial.begin(9600)\n  pinMode(13 OUTPUT);\n}",
    bugLine: 2,
    hint: "Function arguments need separators",
    answers: ["Line 1", "Line 2", "Line 3", "Line 4"]
  },
  {
    code: "int result = map(value, 0, 1023 0, 255);\nSerial.println(result);",
    bugLine: 0,
    hint: "Function has missing separator",
    answers: ["Line 1", "Line 2"]
  },
  {
    code: "while(true) {\n  Serial.println(\"loop\")\n  delay(1000);\n}",
    bugLine: 1,
    hint: "Statement missing punctuation",
    answers: ["Line 1", "Line 2"]
  },
  {
    code: "int ledPin = 13\ndouble voltage = 5.0;\ndigitalWrite(ledPin high);",
    bugLine: 2,
    hint: "Argument missing a separator",
    answers: ["Line 1", "Line 2", "Line 3"]
  },
  {
    code: "for (int x = 0; x <= 5 x++) {\n  Serial.println(x);\n}",
    bugLine: 0,
    hint: "Increment operator missing",
    answers: ["Line 1", "Line 2", "Line 3"]
  },
  {
    code: "int sensor = analogRead(A5)\nif (sensor > 500 {\n  digitalWrite(13, HIGH);\n}",
    bugLine: 1,
    hint: "Missing closing parenthesis",
    answers: ["Line 1", "Line 2", "Line 3", "Line 4"]
  },
  {
    code: "void setup() {\n  pinMode(13 OUTPUT);\n  Serial.begin(9600);\n}",
    bugLine: 1,
    hint: "Arguments need separators",
    answers: ["Line 1", "Line 2", "Line 3", "Line 4"]
  },
  {
    code: "int count = 0\ncount + 1;\nSerial.println(count);",
    bugLine: 0,
    hint: "Variable declaration incomplete",
    answers: ["Line 1", "Line 2", "Line 3"]
  },
  {
    code: "if (x == 5) {\n  ledState = high;\n} else {\n  ledState = LOW;\n}",
    bugLine: 1,
    hint: "Keyword capitalization",
    answers: ["Line 1", "Line 2", "Line 3", "Line 4", "Line 5"]
  },
  {
    code: "void loop() {\n  analogWrite(13 128);\n  delay(500);\n}",
    bugLine: 1,
    hint: "Missing argument separator",
    answers: ["Line 1", "Line 2", "Line 3", "Line 4"]
  },
  {
    code: "int values = {1, 2, 3, 4, 5};\nfor (int i = 0; i < 5; i++)\n  Serial.println(values[i])\n}",
    bugLine: 0,
    hint: "Array needs size declaration",
    answers: ["Line 1", "Line 2", "Line 3", "Line 4"]
  },
  {
    code: "Serial.println(\"Value: \" + value)\ndelay(1000);",
    bugLine: 0,
    hint: "Missing ending punctuation",
    answers: ["Line 1"]
  },
  {
    code: "int buttonPin = 2\nif (digitalRead(buttonPin) = HIGH) {\n  digitalWrite(13, HIGH);\n}",
    bugLine: 1,
    hint: "Assignment vs comparison",
    answers: ["Line 1", "Line 2", "Line 3", "Line 4"]
  },
  {
    code: "digitalWrite(ledPin HIGH);\nSerial.println(\"LED on\");",
    bugLine: 0,
    hint: "Arguments need a separator",
    answers: ["Line 1", "Line 2"]
  },
  {
    code: "void setup() {\n  Serial.begin(9600)\n  pinMode(13, OUTPUT);\n}",
    bugLine: 1,
    hint: "Missing punctuation at end",
    answers: ["Line 1", "Line 2", "Line 3", "Line 4"]
  },
  {
    code: "int x = 10, int y = 20;\nint sum = x + y\nSerial.println(sum);",
    bugLine: 1,
    hint: "Each statement needs punctuation",
    answers: ["Line 1", "Line 2", "Line 3"]
  },
  {
    code: "for(int i=0 i<10; i++) {\n  Serial.println(i);\n}",
    bugLine: 0,
    hint: "Loop parts separated by what?",
    answers: ["Line 1", "Line 2", "Line 3"]
  },
  {
    code: "if(condition1 condition2) {\n  doSomething();\n}",
    bugLine: 0,
    hint: "Logical operator missing",
    answers: ["Line 1", "Line 2", "Line 3"]
  },
  {
    code: "int led[] = {2, 3, 4, 5}\nfor (int i = 0; i < 4; i++)\n  digitalWrite(led[i], high);\n}",
    bugLine: 2,
    hint: "Keyword needs capitalization",
    answers: ["Line 1", "Line 2", "Line 3", "Line 4"]
  },
  {
    code: "switch (state) {\n  case 1\n    Serial.println(\"One\");\n    break;\n}",
    bugLine: 1,
    hint: "Case label incomplete",
    answers: ["Line 1", "Line 2", "Line 3"]
  }
];

const COMPONENT_PAIRS = [
  // Original 10
  { img: "ðŸ’¡", label: "LED" },
  { img: "ðŸ”Œ", label: "Resistor" },
  { img: "ðŸ”˜", label: "Button" },
  { img: "ðŸŽ›ï¸", label: "Potentiometer" },
  { img: "ðŸ“¡", label: "Buzzer" },
  { img: "ðŸŒ¡ï¸", label: "Temperature Sensor" },
  { img: "ðŸŒž", label: "Light Sensor" },
  { img: "âš™ï¸", label: "Servo Motor" },
  { img: "ðŸ”‹", label: "Battery" },
  { img: "ðŸŽ®", label: "Arduino Board" },

  // New 10
  { img: "ðŸ“", label: "Ultrasonic Sensor" },
  { img: "ðŸ”", label: "Relay" },
  { img: "ðŸ“¶", label: "WiFi Module" },
  { img: "ðŸ”µ", label: "Bluetooth Module" },
  { img: "ðŸŒŠ", label: "Water Sensor" },
  { img: "ðŸ’¨", label: "Motion Sensor (PIR)" },
  { img: "â±ï¸", label: "Real Time Clock" },
  { img: "ðŸ’¾", label: "SD Card Module" },
  { img: "ðŸ”¦", label: "Infrared Receiver" },
  { img: "âš¡", label: "Stepper Motor" }
];

const ACHIEVEMENT_BADGES = [
  {
    id: "first_quest",
    title: "First Steps",
    description: "Complete your first quest",
    icon: "ðŸ‘£",
    category: "milestone"
  },
  {
    id: "basics_complete",
    title: "Basics Master",
    description: "Complete all difficulty 1 quests",
    icon: "ðŸ“š",
    category: "milestone"
  },
  {
    id: "halfway",
    title: "Halfway There",
    description: "Complete 6 quests",
    icon: "ðŸƒ",
    category: "milestone"
  },
  {
    id: "all_quests_complete",
    title: "Quest Master",
    description: "Complete all quests",
    icon: "ðŸ†",
    category: "milestone"
  },
  {
    id: "perfect_quiz",
    title: "Quiz Ace",
    description: "Get a perfect score (5/5) on a quiz",
    icon: "â­",
    category: "skill"
  },
  {
    id: "speed_demon",
    title: "Speed Demon",
    description: "Complete a quest in under 2 minutes",
    icon: "âš¡",
    category: "skill"
  },
  {
    id: "bug_hunter",
    title: "Bug Hunter",
    description: "Fix all 3 debug challenges perfectly",
    icon: "ðŸ›",
    category: "skill"
  },
  {
    id: "mini_game_master",
    title: "Game Master",
    description: "Play all game types in mini-games",
    icon: "ðŸŽ®",
    category: "skill"
  },
  {
    id: "streak_3",
    title: "On Fire",
    description: "Complete 3 quests in one session",
    icon: "ðŸ”¥",
    category: "skill"
  },
  {
    id: "no_hints",
    title: "No Training Wheels",
    description: "Complete a quest without using any hints",
    icon: "ðŸš´",
    category: "skill"
  },
  {
    id: "explorer",
    title: "Explorer",
    description: "Visit all steps in a single project",
    icon: "ðŸ—ºï¸",
    category: "special"
  },
  {
    id: "collector",
    title: "Badge Collector",
    description: "Unlock 11 out of 15 badges",
    icon: "ðŸŽ–ï¸",
    category: "special"
  },
  {
    id: "city_hero",
    title: "Arduino Hero",
    description: "Complete everything the lab has to offer",
    icon: "ðŸ¦¸",
    category: "special"
  },
  {
    id: "comeback_kid",
    title: "Comeback Kid",
    description: "Return to the lab after a week away",
    icon: "ðŸ“…",
    category: "special"
  },
  {
    id: "mentor",
    title: "Mentor",
    description: "Help 5 other students learn Arduino",
    icon: "ðŸ¤",
    category: "special"
  }
];

const EXPLAINER_CONCEPTS = [
  {
    id: "circuits_101",
    title: "Circuits 101: Voltage, Current & Resistance",
    projectIds: [1, 2, 3],
    steps: [
      {
        text: "Voltage (V) is like the push of electricity - measured in volts. It tells you how much energy each electron has.",
        visual: "diagram"
      },
      {
        text: "Current (I) is the flow of electricity - measured in amps. It tells you how many electrons are moving through the wire.",
        visual: "animation"
      },
      {
        text: "Resistance (R) is how much something blocks electricity - measured in ohms (Î©). More resistance = less current flows.",
        visual: "diagram"
      },
      {
        text: "In Arduino projects: 5V is safe, 20mA per pin is the limit, and resistors protect your components!",
        visual: "interactive"
      }
    ],
    miniQuiz: {
      q: "If you increase voltage with the same resistor, what happens to current?",
      a: "Current increases",
      wrong: ["Current decreases", "Current stays the same", "Current becomes zero"]
    }
  },
  {
    id: "ohms_law",
    title: "Ohm's Law: V = I Ã— R",
    projectIds: [2, 3, 4],
    steps: [
      {
        text: "Ohm's Law tells us how voltage, current, and resistance are related: V = I Ã— R",
        visual: "formula"
      },
      {
        text: "Example: If you have 5V and 1000Î© resistor, current = 5V Ã· 1000Î© = 0.005A = 5mA",
        visual: "calculation"
      },
      {
        text: "This helps us pick the right resistors to protect LEDs and other components from too much current.",
        visual: "diagram"
      },
      {
        text: "For an Arduino LED: Use 5V, need < 20mA, so resistor should be at least 5V Ã· 20mA = 250Î© (use 330Î©)",
        visual: "interactive"
      }
    ],
    miniQuiz: {
      q: "Using Ohm's Law: What resistor do you need for 5V and 10mA?",
      a: "500Î©",
      wrong: ["50Î©", "1000Î©", "100Î©"]
    }
  },
  {
    id: "digital_vs_analog",
    title: "Digital vs Analog Signals",
    projectIds: [1, 5, 6],
    steps: [
      {
        text: "Digital signals: On or Off, HIGH or LOW, 1 or 0. Like a light switch - either on or off!",
        visual: "animation"
      },
      {
        text: "Analog signals: Any value between min and max, like a dimmer switch. Arduino reads 0-1023.",
        visual: "graph"
      },
      {
        text: "Arduino digital pins: digitalWrite() sends HIGH/LOW, digitalRead() reads HIGH/LOW",
        visual: "diagram"
      },
      {
        text: "Arduino analog pins: analogWrite() sends 0-255 using PWM, analogRead() reads 0-1023",
        visual: "diagram"
      }
    ],
    miniQuiz: {
      q: "A button press is which type of signal?",
      a: "Digital",
      wrong: ["Analog", "Both equally", "Neither"]
    }
  },
  {
    id: "pwm",
    title: "PWM: Making Analog from Digital",
    projectIds: [2, 4, 7],
    steps: [
      {
        text: "PWM = Pulse Width Modulation. It sends digital signals really fast ON-OFF-ON-OFF",
        visual: "animation"
      },
      {
        text: "The longer it stays ON, the brighter the LED. The longer it stays OFF, the dimmer it is.",
        visual: "graph"
      },
      {
        text: "analogWrite(pin, 0) = always OFF (dark). analogWrite(pin, 128) = half ON (medium brightness). analogWrite(pin, 255) = always ON (bright)",
        visual: "interactive"
      },
      {
        text: "Arduino Uno has PWM on pins: 3, 5, 6, 9, 10, 11. These pins have a tilde (~) symbol!",
        visual: "diagram"
      }
    ],
    miniQuiz: {
      q: "To make an LED half brightness with PWM, use analogWrite(pin, ?)",
      a: "128",
      wrong: ["255", "64", "180"]
    }
  },
  {
    id: "serial_communication",
    title: "Serial Communication: Arduino Talking to You",
    projectIds: [3, 5, 8],
    steps: [
      {
        text: "Serial lets Arduino send messages to your computer through the USB cable!",
        visual: "diagram"
      },
      {
        text: "Serial.begin(9600) starts the communication at 9600 baud (bits per second). It's like picking a speed to talk.",
        visual: "interactive"
      },
      {
        text: "Serial.print(value) sends text/numbers. Serial.println(value) sends text/numbers AND starts a new line.",
        visual: "code"
      },
      {
        text: "Open Serial Monitor in Arduino IDE (top right corner) to see messages from your Arduino!",
        visual: "screenshot"
      }
    ],
    miniQuiz: {
      q: "What does Serial.println() do differently from Serial.print()?",
      a: "Adds a new line after the message",
      wrong: ["Prints faster", "Prints to the LCD", "Sends to WiFi"]
    }
  },
  {
    id: "sensors_101",
    title: "Sensors: Detecting the World",
    projectIds: [1, 5, 6, 7],
    steps: [
      {
        text: "Sensors detect things in the world: light, temperature, distance, motion, moisture, sound, etc.",
        visual: "gallery"
      },
      {
        text: "Digital sensors output HIGH or LOW: buttons, PIR motion sensors, limit switches",
        visual: "diagram"
      },
      {
        text: "Analog sensors output a range of values: temperature sensors, light sensors, distance sensors, potentiometers",
        visual: "diagram"
      },
      {
        text: "Always check sensor specs: voltage needed, output type, and how to convert raw values to real measurements!",
        visual: "interactive"
      }
    ],
    miniQuiz: {
      q: "Which sensor detects motion using infrared?",
      a: "PIR sensor",
      wrong: ["Ultrasonic sensor", "Temperature sensor", "Light sensor"]
    }
  },
  {
    id: "motors_and_servos",
    title: "Motors and Servos: Making Things Move",
    projectIds: [2, 4, 7],
    steps: [
      {
        text: "DC Motors: Spin continuously. Use more voltage/current = faster spin. Need a motor driver for Arduino.",
        visual: "animation"
      },
      {
        text: "Servo Motors: Rotate to precise angles (usually 0-180Â°). Control with PWM signal. No driver needed from Arduino!",
        visual: "animation"
      },
      {
        text: "Stepper Motors: Move in exact steps. Great for 3D printers and precise positioning. Need a motor driver.",
        visual: "diagram"
      },
      {
        text: "Arduino Servo library makes it easy: Servo.attach(pin); then Servo.write(angle);",
        visual: "code"
      }
    ],
    miniQuiz: {
      q: "What type of motor can move to a specific angle?",
      a: "Servo motor",
      wrong: ["DC motor", "Stepper motor", "Linear motor"]
    }
  },
  {
    id: "ir_communication",
    title: "Infrared Communication: Wireless Signals",
    projectIds: [6, 8],
    steps: [
      {
        text: "Infrared (IR) is invisible light! TV remotes use IR to talk to TVs without wires.",
        visual: "animation"
      },
      {
        text: "Arduino can use IR receivers to decode remote signals and IR transmitters to send commands.",
        visual: "diagram"
      },
      {
        text: "IR remotes send codes using a special protocol. The Arduino IRremote library decodes these codes for you!",
        visual: "code"
      },
      {
        text: "Great for: wireless robot control, remote-controlled projects, learning about wireless communication!",
        visual: "gallery"
      }
    ],
    miniQuiz: {
      q: "What type of light do IR remote controls use?",
      a: "Infrared (invisible light)",
      wrong: ["Visible light", "Ultraviolet light", "Radio waves"]
    }
  }
];

const CODE_COMPLETION_SNIPPETS = [
  {
    code: "void setup() {\n  ___BLANK_____(13, OUTPUT);\n  Serial.begin(9600);\n}",
    blanks: [
      {
        answer: "pinMode",
        options: ["digitalWrite", "pinMode", "digitalRead", "analogRead"]
      }
    ],
    hint: "This function sets a pin as input or output"
  },
  {
    code: "int sensor = ___BLANK_____(A0);\nSerial.println(sensor);",
    blanks: [
      {
        answer: "analogRead",
        options: ["digitalWrite", "analogRead", "digitalRead", "pinMode"]
      }
    ],
    hint: "This function reads analog values from 0-1023"
  },
  {
    code: "___BLANK___(13, HIGH);\ndelay(1000);\n___BLANK___(13, LOW);",
    blanks: [
      {
        answer: "digitalWrite",
        options: ["digitalWrite", "analogWrite", "digitalRead", "analogRead"]
      },
      {
        answer: "digitalWrite",
        options: ["digitalWrite", "analogWrite", "digitalRead", "analogRead"]
      }
    ],
    hint: "This function sends HIGH or LOW to a digital pin"
  },
  {
    code: "analogWrite(___BLANK___, 128);\nfor (int i = 0; i < ___BLANK___; i++) {\n  Serial.println(i);\n}",
    blanks: [
      {
        answer: "3",
        options: ["2", "3", "13", "A0"]
      },
      {
        answer: "10",
        options: ["5", "10", "20", "255"]
      }
    ],
    hint: "First blank is a PWM pin, second is a loop count"
  },
  {
    code: "if (sensor ___BLANK___ 500) {\n  digitalWrite(ledPin, HIGH);\n}",
    blanks: [
      {
        answer: ">",
        options: ["==", ">", "<", ">="]
      }
    ],
    hint: "This comparison checks if sensor value is greater"
  },
  {
    code: "int values[] = {10, 20, ___BLANK___, 40};\nSerial.println(values[2]);",
    blanks: [
      {
        answer: "30",
        options: ["25", "30", "35", "40"]
      }
    ],
    hint: "Array elements should increase by 10"
  },
  {
    code: "while (true) {\n  Serial.println(\"Loop\");\n  ___BLANK___(500);\n}",
    blanks: [
      {
        answer: "delay",
        options: ["wait", "pause", "delay", "sleep"]
      }
    ],
    hint: "This function pauses in milliseconds"
  },
  {
    code: "int buttonPin = ___BLANK___;\nif (digitalRead(buttonPin) ___BLANK___ HIGH) {\n  doSomething();\n}",
    blanks: [
      {
        answer: "2",
        options: ["0", "2", "A0", "13"]
      },
      {
        answer: "==",
        options: ["=", "==", "!=", "==="]
      }
    ],
    hint: "First is a digital pin, second compares values"
  },
  {
    code: "Serial.___BLANK___(\"Temperature: \");\nSerial.___BLANK___(temp);",
    blanks: [
      {
        answer: "print",
        options: ["write", "print", "println", "send"]
      },
      {
        answer: "println",
        options: ["write", "print", "println", "send"]
      }
    ],
    hint: "First prints text, second prints number and newline"
  },
  {
    code: "for (int i = 0; i ___BLANK___ 5; i++) {\n  digitalWrite(ledPin, ___BLANK___);\n}",
    blanks: [
      {
        answer: "<",
        options: ["<", ">", "<=", ">="]
      },
      {
        answer: "HIGH",
        options: ["HIGH", "LOW", "TRUE", "1"]
      }
    ],
    hint: "First is a comparison, second is a pin state"
  },
  {
    code: "int brightness = ___BLANK___;\nanalogWrite(ledPin, brightness);",
    blanks: [
      {
        answer: "200",
        options: ["1000", "200", "5", "10"]
      }
    ],
    hint: "PWM values range from 0-255, pick something in middle"
  },
  {
    code: "int sensorPin = A___BLANK___;\nint reading = analogRead(sensorPin);",
    blanks: [
      {
        answer: "0",
        options: ["13", "0", "5", "10"]
      }
    ],
    hint: "Arduino Uno has A0-A5 analog pins"
  },
  {
    code: "if (x ___BLANK___ 10 ___BLANK___ y < 5) {\n  Serial.println(\"Condition met\");\n}",
    blanks: [
      {
        answer: ">",
        options: ["==", ">", "<", "!="]
      },
      {
        answer: "&&",
        options: ["||", "&&", "==", "!="]
      }
    ],
    hint: "First checks if x is greater, second combines conditions"
  },
  {
    code: "switch (button) {\n  case ___BLANK___:\n    digitalWrite(ledPin, HIGH);\n    break;\n}",
    blanks: [
      {
        answer: "1",
        options: ["0", "1", "HIGH", "true"]
      }
    ],
    hint: "Switch statement case value"
  },
  {
    code: "long timer = ___BLANK___();\nif (millis() - timer > 1000) {\n  Serial.println(\"1 second passed\");\n}",
    blanks: [
      {
        answer: "millis",
        options: ["time", "millis", "milliSeconds", "timer"]
      }
    ],
    hint: "This function returns milliseconds since startup"
  },
  {
    code: "int value = ___BLANK___(sensorPin, 0, 1023, 0, 255);\nanalogWrite(ledPin, value);",
    blanks: [
      {
        answer: "map",
        options: ["convert", "map", "scale", "transform"]
      }
    ],
    hint: "This function converts from one range to another"
  },
  {
    code: "Servo myServo;\nvoid setup() {\n  myServo.___BLANK___(___BLANK___);\n}",
    blanks: [
      {
        answer: "attach",
        options: ["connect", "attach", "begin", "init"]
      },
      {
        answer: "9",
        options: ["3", "9", "13", "A0"]
      }
    ],
    hint: "First attaches servo to pin, second is pin number"
  },
  {
    code: "unsigned long lastTime = 0;\nvoid loop() {\n  if (millis() - lastTime ___BLANK___ 500) {\n    lastTime = millis();\n    doSomething();\n  }\n}",
    blanks: [
      {
        answer: ">=",
        options: ["==", ">", ">=", "<"]
      }
    ],
    hint: "Check if enough time has passed"
  },
  {
    code: "String message = \"Hello \" + ___BLANK___;\nSerial.println(message);",
    blanks: [
      {
        answer: "\"Arduino\"",
        options: ["\"Arduino\"", "Arduino", "\"LCD\"", "\"World\""]
      }
    ],
    hint: "String concatenation with quotes"
  },
  {
    code: "float temperature = analogRead(A0) * ___BLANK___ / 1024.0;\nSerial.println(temperature);",
    blanks: [
      {
        answer: "5.0",
        options: ["1.0", "3.3", "5.0", "12.0"]
      }
    ],
    hint: "Convert 0-1023 reading to 0-5V range"
  }
];




// â”€â”€â”€ SYNTAX HIGHLIGHTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function highlightArduinoCode(code) {
  // Escape HTML first to prevent < > & from breaking the output
  let html = code
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;');

  // Use a placeholder system to protect already-highlighted spans from being corrupted
  const placeholders = {};
  let placeholderCount = 0;

  // Helper to create placeholders for spans
  const createPlaceholder = (html) => {
    const key = `__PLACEHOLDER_${placeholderCount}__`;
    placeholders[key] = html;
    placeholderCount++;
    return key;
  };

  // Define patterns - must escape them since we're working with escaped HTML
  const keywords = /\b(void|int|bool|long|float|double|char|byte|if|else|for|while|do|return|switch|case|default|true|false|const|volatile)\b/g;
  const types = /\b(HIGH|LOW|INPUT|OUTPUT|INPUT_PULLUP|OUTPUT_OD)\b/g;
  const functions = /\b(pinMode|digitalWrite|digitalRead|analogWrite|analogRead|delay|delayMicroseconds|millis|micros|Serial|tone|noTone|map|pulseIn|attachInterrupt|detachInterrupt)\b/g;
  const comments = /\/\/[^\n]*/g;
  const strings = /"[^"]*"|'[^']*'/g;
  const numbers = /\b\d+\b/g;

  // Apply highlighting in a single pass - do it smartly to avoid re-highlighting
  html = html.replace(comments, match => createPlaceholder('<span class="cm">' + match + '</span>'));
  html = html.replace(strings, match => createPlaceholder('<span class="str">' + match + '</span>'));
  html = html.replace(keywords, match => createPlaceholder('<span class="kw">' + match + '</span>'));
  html = html.replace(types, match => createPlaceholder('<span class="type">' + match + '</span>'));
  html = html.replace(functions, match => createPlaceholder('<span class="fn">' + match + '</span>'));
  html = html.replace(numbers, match => createPlaceholder('<span class="num">' + match + '</span>'));

  // Replace all placeholders with actual spans
  Object.keys(placeholders).forEach(key => {
    html = html.replace(new RegExp(key, 'g'), placeholders[key]);
  });

  return html;
}

// â”€â”€â”€ SVG WIRING DIAGRAM RENDERER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function WiringDiagram({ diagram, color }) {
  if (!diagram) return null;
  const w = diagram.width || 600, h = diagram.height || 300;
  
  const drawComponent = (c, i) => {
    const types = {
      arduino: () => React.createElement("g", {key:i},
        React.createElement("rect", {x:c.x,y:c.y,width:120,height:160,rx:8,fill:"#1e40af",stroke:"#3b82f6",strokeWidth:2}),
        React.createElement("text", {x:c.x+60,y:c.y+85,textAnchor:"middle",fill:"#fff",fontSize:11,fontWeight:700}, "Arduino"),
        React.createElement("text", {x:c.x+60,y:c.y+100,textAnchor:"middle",fill:"#93c5fd",fontSize:9}, "Uno"),
        ...[13,12,11,10,9,8,7,6,5,4,3,2].map((pin,j) =>
          React.createElement("text", {key:"p"+j,x:c.x+125,y:c.y+20+j*11,fill:"#93c5fd",fontSize:7}, pin)
        ),
        ...["A0","A1","A2","A3","A4","A5"].map((pin,j) =>
          React.createElement("text", {key:"a"+j,x:c.x+10+j*18,y:c.y+155,fill:"#93c5fd",fontSize:7}, pin)
        ),
        React.createElement("text", {x:c.x+5,y:c.y+20,fill:"#ef4444",fontSize:7}, "5V"),
        React.createElement("text", {x:c.x+5,y:c.y+35,fill:"#666",fontSize:7}, "GND")
      ),
      led: () => React.createElement("g", {key:i},
        React.createElement("circle", {cx:c.x+15,cy:c.y+15,r:12,fill:c.color||"#22c55e",opacity:0.8,stroke:c.color||"#22c55e",strokeWidth:2}),
        React.createElement("circle", {cx:c.x+15,cy:c.y+15,r:6,fill:"#fff",opacity:0.4}),
        c.label && React.createElement("text", {x:c.x+15,y:c.y+38,textAnchor:"middle",fill:"#94a3b8",fontSize:9}, c.label)
      ),
      resistor: () => React.createElement("g", {key:i},
        React.createElement("rect", {x:c.x,y:c.y,width:50,height:16,rx:3,fill:"#78716c",stroke:"#a8a29e",strokeWidth:1}),
        React.createElement("line", {x1:c.x+10,y1:c.y+4,x2:c.x+10,y2:c.y+12,stroke:"#dc2626",strokeWidth:2}),
        React.createElement("line", {x1:c.x+20,y1:c.y+4,x2:c.x+20,y2:c.y+12,stroke:"#000",strokeWidth:2}),
        React.createElement("line", {x1:c.x+30,y1:c.y+4,x2:c.x+30,y2:c.y+12,stroke:"#f97316",strokeWidth:2}),
        c.label && React.createElement("text", {x:c.x+25,y:c.y+30,textAnchor:"middle",fill:"#94a3b8",fontSize:8}, c.label)
      ),
      buzzer: () => React.createElement("g", {key:i},
        React.createElement("circle", {cx:c.x+15,cy:c.y+15,r:15,fill:"#1e293b",stroke:"#64748b",strokeWidth:2}),
        React.createElement("text", {x:c.x+15,y:c.y+19,textAnchor:"middle",fill:"#94a3b8",fontSize:10}, "â™ª"),
        c.label && React.createElement("text", {x:c.x+15,y:c.y+40,textAnchor:"middle",fill:"#94a3b8",fontSize:9}, c.label)
      ),
      button: () => React.createElement("g", {key:i},
        React.createElement("rect", {x:c.x,y:c.y,width:30,height:30,rx:4,fill:"#334155",stroke:"#64748b",strokeWidth:2}),
        React.createElement("circle", {cx:c.x+15,cy:c.y+15,r:8,fill:"#475569",stroke:"#94a3b8",strokeWidth:1}),
        c.label && React.createElement("text", {x:c.x+15,y:c.y+48,textAnchor:"middle",fill:"#94a3b8",fontSize:8}, c.label)
      ),
      sensor: () => React.createElement("g", {key:i},
        React.createElement("rect", {x:c.x,y:c.y,width:70,height:35,rx:4,fill:"#0f172a",stroke:"#06b6d4",strokeWidth:2}),
        React.createElement("text", {x:c.x+35,y:c.y+21,textAnchor:"middle",fill:"#06b6d4",fontSize:9,fontWeight:600}, c.label||"Sensor")
      )
    };
    return (types[c.type] || types.sensor)();
  };

  const drawWire = (w, i) => React.createElement("g", {key:"w"+i},
    React.createElement("line", {x1:w.from[0],y1:w.from[1],x2:w.to[0],y2:w.to[1],stroke:w.color||"#ef4444",strokeWidth:2,strokeLinecap:"round"}),
    w.label && React.createElement("text", {
      x:(w.from[0]+w.to[0])/2, y:(w.from[1]+w.to[1])/2 - 6,
      textAnchor:"middle", fill:w.color||"#ef4444", fontSize:8, fontWeight:600
    }, w.label)
  );

  return React.createElement("div", {style:{background:"#0f172a",borderRadius:12,padding:16,border:"1px solid #1e293b",marginBottom:20}},
    React.createElement("svg", {viewBox:"0 0 "+w+" "+h,width:"100%",style:{maxHeight:320}},
      React.createElement("defs", null,
        React.createElement("pattern", {id:"grid",width:20,height:20,patternUnits:"userSpaceOnUse"},
          React.createElement("circle", {cx:2,cy:2,r:0.5,fill:"#1e293b"})
        )
      ),
      React.createElement("rect", {width:w,height:h,fill:"url(#grid)"}),
      diagram.wires && diagram.wires.map(drawWire),
      diagram.components && diagram.components.map(drawComponent)
    )
  );
}

// â”€â”€â”€ BADGE SYSTEM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function checkBadgeUnlocks(completed, bonusXp, gameHistory, badges) {
  const completedCount = Object.keys(completed).filter(k => completed[k]).length;
  const newBadges = [];
  const b = badges || {};
  
  const unlock = (id) => {
    if (!b[id]) { b[id] = { unlocked: true, at: Date.now() }; newBadges.push(id); }
  };
  
  if (completedCount >= 1) unlock("first_quest");
  if ([1,2].every(id => completed[id])) unlock("basics_complete");
  if (completedCount >= 6) unlock("halfway");
  if (completedCount >= 12) unlock("all_quests_complete");
  if (gameHistory && gameHistory.perfectQuiz) unlock("perfect_quiz");
  if (gameHistory && gameHistory.perfectDebug) unlock("bug_hunter");
  if (gameHistory && gameHistory.gameTypes && gameHistory.gameTypes.size >= 5) unlock("mini_game_master");
  if (gameHistory && gameHistory.sessionCompletions >= 3) unlock("streak_3");
  if (Object.keys(b).filter(k => b[k] && b[k].unlocked).length >= 11) unlock("collector");
  if (completedCount >= 12 && Object.keys(b).filter(k => b[k] && b[k].unlocked).length >= 12) unlock("city_hero");
  
  return { badges: b, newBadges };
}

// â”€â”€â”€ MINI-GAME FUNCTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function generateComponentMatchGame(questId) {
  const shuffled = [...COMPONENT_PAIRS].sort(() => Math.random() - 0.5).slice(0, 4);
  let cards = [...shuffled, ...shuffled].sort(() => Math.random() - 0.5);
  return { type: "match", cards, matched: 0, attempts: 0, startTime: Date.now() };
}

function generateDebugCodeGame(questId) {
  const shuffled = [...DEBUG_CODE_SNIPPETS].sort(() => Math.random() - 0.5).slice(0, 3);
  return { type: "debug", bugs: shuffled, score: 0, round: 0 };
}

function generateQuizGame(questId) {
  const shuffled = [...QUIZ_QUESTIONS].sort(() => Math.random() - 0.5).slice(0, 5).map(q => ({
    ...q,
    options: [q.a, ...q.wrong].sort(() => Math.random() - 0.5),
    answered: false
  }));
  return { type: "quiz", questions: shuffled, score: 0, index: 0 };
}

function generateWiringGame(questId) {
  const project = PROJECTS.find(p => p.id === questId) || PROJECTS[0];
  const connections = project.wiring.map((w, i) => ({
    id: i, from: w.from, to: w.to, note: w.note, connected: false
  }));
  return { type: "wiring", connections: connections.sort(() => Math.random() - 0.5), score: 0, startTime: Date.now() };
}

function generateCodeCompletionGame(questId) {
  const shuffled = [...CODE_COMPLETION_SNIPPETS].sort(() => Math.random() - 0.5).slice(0, 3);
  return { type: "codecomplete", snippets: shuffled, score: 0, round: 0 };
}

// â”€â”€â”€ MAIN APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// â”€â”€â”€ BADGE TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function BadgeToast({ badge, onDismiss }) {
  const b = ACHIEVEMENT_BADGES.find(a => a.id === badge);
  if (!b) return null;
  useEffect(() => { const t = setTimeout(onDismiss, 3000); return () => clearTimeout(t); }, []);
  return React.createElement("div", {
    style: { position:"fixed",top:20,right:20,zIndex:2000,background:"linear-gradient(135deg,#1e293b,#0f172a)",border:"2px solid #eab308",borderRadius:16,padding:"16px 24px",display:"flex",alignItems:"center",gap:16,animation:"slideIn 0.4s ease",boxShadow:"0 8px 32px rgba(234,179,8,0.3)" }
  },
    React.createElement("div", {style:{fontSize:40}}, b.icon),
    React.createElement("div", null,
      React.createElement("div", {style:{fontSize:10,color:"#eab308",fontWeight:800,textTransform:"uppercase",letterSpacing:1}}, "Badge Unlocked!"),
      React.createElement("div", {style:{fontSize:16,fontWeight:700,color:"#e2e8f0"}}, b.title),
      React.createElement("div", {style:{fontSize:12,color:"#94a3b8"}}, b.description)
    )
  );
}

// â”€â”€â”€ ACHIEVEMENT MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function AchievementModal({ badges, onClose }) {
  return React.createElement("div", {
    onClick: onClose,
    style: {position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",zIndex:1000,display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(6px)"}
  },
    React.createElement("div", {
      onClick: e => e.stopPropagation(),
      style: {background:"#131a2b",border:"1px solid #1e293b",borderRadius:20,padding:32,maxWidth:560,width:"90%",maxHeight:"85vh",overflowY:"auto",animation:"fadeIn 0.3s ease"}
    },
      React.createElement("div", {style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24}},
        React.createElement("h2", {style:{fontFamily:"'Fredoka One',cursive",fontSize:22,color:"#e2e8f0"}}, "ðŸ† Achievements"),
        React.createElement("button", {onClick:onClose,style:{background:"none",border:"none",color:"#64748b",fontSize:22,cursor:"pointer"}}, "âœ•")
      ),
      React.createElement("div", {style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(140px,1fr))",gap:16}},
        ACHIEVEMENT_BADGES.map(b => {
          const unlocked = badges[b.id] && badges[b.id].unlocked;
          return React.createElement("div", {
            key: b.id,
            style: {
              textAlign:"center",padding:16,borderRadius:12,
              background: unlocked ? "rgba(234,179,8,0.1)" : "rgba(15,23,42,0.6)",
              border: unlocked ? "1px solid rgba(234,179,8,0.3)" : "1px solid #1e293b",
              opacity: unlocked ? 1 : 0.4, transition:"all 0.3s"
            }
          },
            React.createElement("div", {style:{fontSize:36,marginBottom:8}}, unlocked ? b.icon : "ðŸ”’"),
            React.createElement("div", {style:{fontSize:12,fontWeight:700,color:unlocked?"#e2e8f0":"#475569"}}, b.title),
            React.createElement("div", {style:{fontSize:10,color:"#64748b",marginTop:4}}, b.description)
          );
        })
      )
    )
  );
}

// â”€â”€â”€ EXPLAINER VIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ExplainerView({ conceptId, onClose, onXpEarned }) {
  const concept = EXPLAINER_CONCEPTS.find(c => c.id === conceptId);
  const [step, setStep] = useState(0);
  const [quizAnswer, setQuizAnswer] = useState(null);
  const [quizSubmitted, setQuizSubmitted] = useState(false);
  
  if (!concept) return null;
  const isQuizStep = step >= concept.steps.length;
  const totalSteps = concept.steps.length + 1;
  const visualIcons = {diagram:"ðŸ“",animation:"ðŸŽ¬",graph:"ðŸ“Š",formula:"ðŸ”¢",calculation:"ðŸ§®",interactive:"ðŸ–±ï¸",code:"ðŸ’»",gallery:"ðŸ–¼ï¸",screenshot:"ðŸ“·"};
  
  return React.createElement("div", {
    onClick: onClose,
    style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.8)",zIndex:1000,display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(6px)"}
  },
    React.createElement("div", {
      onClick:e=>e.stopPropagation(),
      style:{background:"#131a2b",border:"1px solid #1e293b",borderRadius:20,padding:32,maxWidth:600,width:"90%",animation:"fadeIn 0.3s ease"}
    },
      React.createElement("div", {style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20}},
        React.createElement("h3", {style:{fontFamily:"'Fredoka One',cursive",color:"#06b6d4",fontSize:20}}, "ðŸ’¡ " + concept.title),
        React.createElement("button", {onClick:onClose,style:{background:"none",border:"none",color:"#64748b",fontSize:20,cursor:"pointer"}}, "âœ•")
      ),
      React.createElement("div", {style:{display:"flex",gap:4,marginBottom:24}},
        Array.from({length:totalSteps}).map((_,i) =>
          React.createElement("div", {key:i,style:{flex:1,height:4,borderRadius:2,background:i<=step?"#06b6d4":"#1e293b",transition:"all 0.3s"}})
        )
      ),
      !isQuizStep ? React.createElement("div", {style:{animation:"fadeIn 0.3s ease"}},
        React.createElement("div", {style:{fontSize:48,textAlign:"center",marginBottom:16}}, visualIcons[concept.steps[step].visual] || "ðŸ“–"),
        React.createElement("p", {style:{fontSize:16,lineHeight:1.8,color:"#e2e8f0",textAlign:"center",marginBottom:24}}, concept.steps[step].text),
        React.createElement("div", {style:{display:"flex",justifyContent:"space-between"}},
          step > 0 ? React.createElement("button", {onClick:()=>setStep(step-1),style:{padding:"10px 24px",borderRadius:10,border:"1px solid #334155",background:"rgba(30,41,59,0.6)",color:"#94a3b8",cursor:"pointer",fontFamily:"Nunito"}}, "â† Back") : React.createElement("div"),
          React.createElement("button", {onClick:()=>setStep(step+1),style:{padding:"10px 24px",borderRadius:10,border:"none",background:"#06b6d4",color:"#fff",fontWeight:700,cursor:"pointer",fontFamily:"Nunito"}}, "Next â†’")
        )
      ) :
      React.createElement("div", {style:{animation:"fadeIn 0.3s ease"}},
        React.createElement("div", {style:{fontSize:36,textAlign:"center",marginBottom:12}}, "ðŸ§ª"),
        React.createElement("p", {style:{fontSize:16,fontWeight:700,color:"#e2e8f0",textAlign:"center",marginBottom:20}}, concept.miniQuiz.q),
        React.createElement("div", {style:{display:"flex",flexDirection:"column",gap:10}},
          [concept.miniQuiz.a, ...concept.miniQuiz.wrong].sort(() => Math.random() - 0.5).map((opt,i) => {
            const isCorrect = quizSubmitted && opt === concept.miniQuiz.a;
            const isWrong = quizSubmitted && quizAnswer === opt && opt !== concept.miniQuiz.a;
            return React.createElement("button", {
              key:i,
              onClick:() => { if (!quizSubmitted) { setQuizAnswer(opt); setQuizSubmitted(true); if(opt===concept.miniQuiz.a && onXpEarned) onXpEarned(15); }},
              style:{padding:"12px 20px",borderRadius:10,border:"2px solid "+(isCorrect?"#22c55e":isWrong?"#ef4444":quizAnswer===opt?"#06b6d4":"#334155"),background:isCorrect?"rgba(34,197,94,0.15)":isWrong?"rgba(239,68,68,0.15)":"rgba(26,35,53,0.85)",color:"#e2e8f0",cursor:quizSubmitted?"default":"pointer",fontWeight:600,textAlign:"left",fontFamily:"Nunito",transition:"all 0.2s"}
            }, opt + (isCorrect?" âœ“":"") + (isWrong?" âœ—":""));
          })
        ),
        quizSubmitted && React.createElement("div", {style:{textAlign:"center",marginTop:20}},
          React.createElement("p", {style:{color:quizAnswer===concept.miniQuiz.a?"#22c55e":"#ef4444",fontWeight:700}},
            quizAnswer===concept.miniQuiz.a ? "âœ“ Correct! +15 XP" : "Not quite â€” the answer is: " + concept.miniQuiz.a
          ),
          React.createElement("button", {onClick:onClose,style:{marginTop:12,padding:"10px 24px",borderRadius:10,border:"none",background:"#334155",color:"#fff",cursor:"pointer",fontFamily:"Nunito"}}, "Close")
        )
      )
    )
  );
}

// â”€â”€â”€ WIRING GAME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function WiringGame({ game, onClose, onComplete }) {
  const [selected, setSelected] = useState(null);
  const [connected, setConnected] = useState({});
  const [score, setScore] = useState(0);
  const connections = game.connections;
  const total = connections.length;
  
  const handleSelect = (idx) => {
    if (connected[idx]) return;
    if (selected === null) { setSelected(idx); return; }
    if (selected === idx) { setSelected(null); return; }
    const newConnected = {...connected, [selected]: true, [idx]: true};
    setConnected(newConnected);
    setScore(score + 10);
    setSelected(null);
    if (Object.keys(newConnected).length >= total) {
      setTimeout(() => onComplete(Math.min(50, score + 10)), 600);
    }
  };
  
  return React.createElement("div", {style:{minHeight:"100vh",background:"#131a2b",padding:24,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}},
    React.createElement("h2", {style:{fontFamily:"'Fredoka One',cursive",fontSize:28,color:"#f97316",marginBottom:12}}, "ðŸ”Œ Wiring Challenge"),
    React.createElement("p", {style:{color:"#94a3b8",marginBottom:24}}, "Connect the matching wire pairs! Score: " + score),
    React.createElement("div", {style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(200px,1fr))",gap:12,maxWidth:600,width:"100%"}},
      connections.map((c, idx) =>
        React.createElement("div", {
          key: idx,
          onClick: () => handleSelect(idx),
          style: {
            padding:"14px 18px",borderRadius:12,cursor:connected[idx]?"default":"pointer",
            background:connected[idx]?"rgba(34,197,94,0.15)":selected===idx?"rgba(249,115,22,0.2)":"rgba(26,35,53,0.85)",
            border:connected[idx]?"2px solid #22c55e":selected===idx?"2px solid #f97316":"2px solid #334155",
            transition:"all 0.2s"
          }
        },
          React.createElement("div", {style:{fontWeight:700,color:"#e2e8f0",fontSize:14}}, c.from + (c.to ? " â†’ " + c.to : "")),
          c.note && React.createElement("div", {style:{fontSize:12,color:"#64748b",marginTop:4}}, c.note),
          connected[idx] && React.createElement("span", {style:{color:"#22c55e",fontWeight:700}}, " âœ“")
        )
      )
    ),
    Object.keys(connected).length >= total && React.createElement("div", {style:{marginTop:24,textAlign:"center"}},
      React.createElement("p", {style:{color:"#22c55e",fontSize:18,fontWeight:700}}, "âœ“ All connected! +" + Math.min(50, score) + " XP"),
      React.createElement("button", {onClick:onClose,style:{marginTop:12,padding:"10px 20px",borderRadius:8,border:"none",background:"#22c55e",color:"#000",fontWeight:700,cursor:"pointer"}}, "Continue")
    )
  );
}

// â”€â”€â”€ CODE COMPLETION GAME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function CodeCompletionGame({ game, onClose, onComplete }) {
  const [round, setRound] = useState(0);
  const [answers, setAnswers] = useState({});
  const [submitted, setSubmitted] = useState(false);
  const scoreRef = useRef(0);
  
  const snippet = game.snippets[round];
  if (!snippet) return null;
  
  const parts = snippet.code.split("___BLANK___");
  
  const handleSelect = (blankIdx, value) => {
    if (submitted) return;
    setAnswers(prev => ({...prev, [blankIdx]: value}));
  };
  
  const handleSubmit = () => {
    setSubmitted(true);
    let correct = 0;
    snippet.blanks.forEach((b, i) => { if (answers[i] === b.answer) correct++; });
    scoreRef.current += correct * 10;
    
    setTimeout(() => {
      if (round < game.snippets.length - 1) {
        setRound(round + 1);
        setAnswers({});
        setSubmitted(false);
      } else {
        onComplete(scoreRef.current);
      }
    }, 1500);
  };
  
  const allFilled = snippet.blanks.every((_, i) => answers[i] !== undefined);
  
  return React.createElement("div", {style:{minHeight:"100vh",background:"#131a2b",padding:24,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}},
    React.createElement("h2", {style:{fontFamily:"'Fredoka One',cursive",fontSize:28,color:"#3b82f6",marginBottom:12}}, "ðŸ’» Code Builder"),
    React.createElement("p", {style:{color:"#94a3b8",marginBottom:8}}, "Round " + (round+1) + " of " + game.snippets.length + " â€” Fill in the blanks!"),
    React.createElement("p", {style:{color:"#3b82f6",fontSize:13,marginBottom:24,fontStyle:"italic"}}, "Hint: " + snippet.hint),
    React.createElement("pre", {style:{background:"#0d1117",border:"1px solid #30363d",borderRadius:8,padding:16,marginBottom:24,maxWidth:600,width:"100%"}},
      parts.map((part, i) => React.createElement(React.Fragment, {key:i},
        React.createElement("code", null, part),
        i < snippet.blanks.length && React.createElement("select", {
          value: answers[i] || "",
          onChange: (e) => handleSelect(i, e.target.value),
          disabled: submitted,
          style: {
            background: submitted ? (answers[i] === snippet.blanks[i].answer ? "#166534" : "#991b1b") : "#1e293b",
            color: "#e2e8f0", border: "2px solid " + (submitted ? (answers[i] === snippet.blanks[i].answer ? "#22c55e" : "#ef4444") : "#3b82f6"),
            borderRadius: 6, padding: "4px 8px", fontSize: 13, fontFamily: "'Fira Code',monospace", cursor: submitted ? "default" : "pointer"
          }
        },
          React.createElement("option", {value:""}, "???"),
          snippet.blanks[i].options.map(opt =>
            React.createElement("option", {key:opt, value:opt}, opt)
          )
        )
      ))
    ),
    !submitted && React.createElement("button", {
      onClick: handleSubmit,
      disabled: !allFilled,
      style: {padding:"12px 32px",borderRadius:10,border:"none",background:allFilled?"#3b82f6":"#334155",color:"#fff",fontWeight:700,cursor:allFilled?"pointer":"not-allowed",fontSize:16}
    }, "Submit"),
    submitted && React.createElement("div", {style:{marginTop:16,color:"#94a3b8",fontSize:14}}, "Score: " + scoreRef.current)
  );
}

// â”€â”€â”€ PARENT DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ParentDashboard({ completed, bonusXp, badges, onClose }) {
  const [pin, setPin] = useState("");
  const [authenticated, setAuthenticated] = useState(false);
  const [settingPin, setSettingPin] = useState(false);
  
  const storedPin = (() => { try { return localStorage.getItem("sparkcity_parent_pin"); } catch(e) { return null; } })();
  
  useEffect(() => {
    if (!storedPin) setSettingPin(true);
  }, []);
  
  const handlePinSubmit = () => {
    if (settingPin) {
      try { localStorage.setItem("sparkcity_parent_pin", pin); } catch(e) {}
      setSettingPin(false);
      setAuthenticated(true);
    } else if (pin === storedPin) {
      setAuthenticated(true);
    }
    setPin("");
  };
  
  if (!authenticated) {
    return React.createElement("div", {
      onClick: onClose,
      style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",zIndex:1000,display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(6px)"}
    },
      React.createElement("div", {
        onClick:e=>e.stopPropagation(),
        style:{background:"#131a2b",border:"1px solid #1e293b",borderRadius:20,padding:32,maxWidth:400,width:"90%",textAlign:"center"}
      },
        React.createElement("div", {style:{fontSize:48,marginBottom:16}}, "ðŸ”’"),
        React.createElement("h3", {style:{fontFamily:"'Fredoka One',cursive",color:"#e2e8f0",marginBottom:8}}, settingPin ? "Set Parent PIN" : "Enter Parent PIN"),
        React.createElement("p", {style:{color:"#64748b",fontSize:13,marginBottom:20}}, settingPin ? "Choose a 4-digit PIN to protect the dashboard" : "Enter your 4-digit PIN"),
        React.createElement("input", {
          type:"password", maxLength:4, value:pin,
          onChange:e => setPin(e.target.value.replace(/\D/g,"")),
          onKeyDown:e => e.key==="Enter" && pin.length===4 && handlePinSubmit(),
          style:{width:120,padding:"12px",fontSize:24,textAlign:"center",borderRadius:10,border:"2px solid #334155",background:"#1e293b",color:"#fff",fontFamily:"monospace",letterSpacing:8},
          placeholder:"â€¢â€¢â€¢â€¢"
        }),
        React.createElement("div", {style:{marginTop:16,display:"flex",gap:12,justifyContent:"center"}},
          React.createElement("button", {onClick:onClose,style:{padding:"10px 24px",borderRadius:10,border:"1px solid #334155",background:"transparent",color:"#94a3b8",cursor:"pointer",fontFamily:"Nunito"}}, "Cancel"),
          React.createElement("button", {
            onClick:handlePinSubmit,
            disabled:pin.length!==4,
            style:{padding:"10px 24px",borderRadius:10,border:"none",background:pin.length===4?"#a855f7":"#334155",color:"#fff",fontWeight:700,cursor:pin.length===4?"pointer":"not-allowed",fontFamily:"Nunito"}
          }, settingPin ? "Set PIN" : "Unlock")
        )
      )
    );
  }
  
  const completedCount = Object.keys(completed).filter(k => completed[k]).length;
  const totalXp = completedCount * 100 + bonusXp;
  const unlockedBadges = Object.keys(badges).filter(k => badges[k] && badges[k].unlocked);
  
  return React.createElement("div", {
    onClick:onClose,
    style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",zIndex:1000,display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(6px)"}
  },
    React.createElement("div", {
      onClick:e=>e.stopPropagation(),
      style:{background:"#131a2b",border:"1px solid #1e293b",borderRadius:20,padding:32,maxWidth:600,width:"90%",maxHeight:"85vh",overflowY:"auto"}
    },
      React.createElement("div", {style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24}},
        React.createElement("h2", {style:{fontFamily:"'Fredoka One',cursive",fontSize:22,color:"#a855f7"}}, "ðŸ‘¨â€ðŸ‘©â€ðŸ‘§ Parent Dashboard"),
        React.createElement("button", {onClick:onClose,style:{background:"none",border:"none",color:"#64748b",fontSize:22,cursor:"pointer"}}, "âœ•")
      ),
      React.createElement("div", {style:{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:16,marginBottom:24}},
        [{label:"Quests Done",value:completedCount+"/12",color:"#22c55e"},{label:"Total XP",value:totalXp,color:"#3b82f6"},{label:"Badges",value:unlockedBadges.length+"/"+ACHIEVEMENT_BADGES.length,color:"#eab308"}].map((s,i) =>
          React.createElement("div", {key:i,style:{textAlign:"center",padding:16,borderRadius:12,background:"rgba(26,35,53,0.85)",border:"1px solid #1e293b"}},
            React.createElement("div", {style:{fontSize:24,fontWeight:800,color:s.color}}, s.value),
            React.createElement("div", {style:{fontSize:11,color:"#64748b",marginTop:4}}, s.label)
          )
        )
      ),
      React.createElement("div", {style:{marginBottom:24}},
        React.createElement("div", {style:{fontSize:13,color:"#94a3b8",marginBottom:8}}, "Overall Progress"),
        React.createElement("div", {style:{width:"100%",height:12,background:"#1e293b",borderRadius:6,overflow:"hidden"}},
          React.createElement("div", {style:{width:Math.round(completedCount/12*100)+"%",height:"100%",background:"linear-gradient(90deg,#22c55e,#3b82f6)",borderRadius:6,transition:"width 0.5s"}})
        )
      ),
      React.createElement("h4", {style:{color:"#94a3b8",fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:1,marginBottom:12}}, "Completed Quests"),
      PROJECTS.filter(p => completed[p.id]).length > 0 ?
        PROJECTS.filter(p => completed[p.id]).map(p =>
          React.createElement("div", {key:p.id,style:{display:"flex",alignItems:"center",gap:12,padding:"8px 0",borderBottom:"1px solid #1e293b"}},
            React.createElement("span", {style:{fontSize:20}}, p.icon),
            React.createElement("span", {style:{color:"#e2e8f0",fontSize:14}}, p.title),
            React.createElement("span", {style:{marginLeft:"auto",color:"#22c55e",fontSize:12,fontWeight:700}}, "âœ“ Done")
          )
        ) :
        React.createElement("p", {style:{color:"#475569",fontSize:14,fontStyle:"italic"}}, "No quests completed yet"),
      unlockedBadges.length > 0 && React.createElement("div", {style:{marginTop:24}},
        React.createElement("h4", {style:{color:"#94a3b8",fontSize:13,fontWeight:700,textTransform:"uppercase",letterSpacing:1,marginBottom:12}}, "Badges Earned"),
        React.createElement("div", {style:{display:"flex",flexWrap:"wrap",gap:8}},
          unlockedBadges.map(id => {
            const b = ACHIEVEMENT_BADGES.find(a => a.id === id);
            return b && React.createElement("div", {key:id,style:{padding:"6px 12px",borderRadius:8,background:"rgba(234,179,8,0.1)",border:"1px solid rgba(234,179,8,0.3)"}},
              React.createElement("span", null, b.icon + " " + b.title)
            );
          })
        )
      )
    )
  );
}

function App() {
  const [view, setView] = useState("world");
  const [selectedQuest, setSelectedQuest] = useState(null);
  const [completed, setCompleted] = useState({});
  const [player, setPlayer] = useState("");
  const [showSetup, setShowSetup] = useState(true);
  const [miniGame, setMiniGame] = useState(null);
  const [xpPops, setXpPops] = useState([]);
  const [showLevels, setShowLevels] = useState(false);
  const [bonusXp, setBonusXp] = useState(0);

  const completedCount = Object.keys(completed).filter(k => completed[k]).length;
  const totalProjects = PROJECTS.length;
  const xp = completedCount * 100 + bonusXp;
  const level = Math.floor(xp / 100) + 1;

  const titleNames = [
    "New Recruit",
    "Circuit Cadet",
    "Wire Wrangler",
    "Signal Scout",
    "Spark Apprentice",
    "Sensor Specialist",
    "Code Commander",
    "Motor Mechanic",
    "Systems Engineer",
    "Robotics Expert",
    "Master Inventor",
    "Spark City Guardian",
    "City Hero"
  ];
  const [badges, setBadges] = useState({});
  const [badgeToast, setBadgeToast] = useState(null);
  const [showAchievements, setShowAchievements] = useState(false);
  const [showParentDash, setShowParentDash] = useState(false);
  const [showExplainer, setShowExplainer] = useState(null);
  const [gameHistory, setGameHistory] = useState({ gameTypes: new Set(), sessionCompletions: 0 });
  const title = titleNames[Math.min(level - 1, titleNames.length - 1)];
  const nextTitle = titleNames[Math.min(level, titleNames.length - 1)];
  const xpForNextLevel = level * 100;
  const xpProgress = xp % 100;

  const toggleComplete = (id) => {
    if (!completed[id]) {
      addXpPop(100);
    }
    const newCompleted = { ...completed, [id]: !completed[id] };
    setCompleted(newCompleted);
    // Check for badge unlocks
    const result = checkBadgeUnlocks(newCompleted, bonusXp, gameHistory, badges);
    if (result.newBadges.length > 0) {
      setBadges(result.badges);
      setBadgeToast(result.newBadges[0]);
    }
  };

  const addXpPop = (amount) => {
    const id = Math.random();
    setXpPops(prev => [...prev, { id, x: 50 + Math.random() * 30, y: 50 + Math.random() * 30, xp: amount }]);
    setTimeout(() => setXpPops(prev => prev.filter(p => p.id !== id)), 600);
  };

  const saveState = (playerName, completedState, bonusXpState) => {
    try {
      const data = { completed: completedState, bonusXp: bonusXpState, badges: badges || {}, lastPlayed: Date.now() };
      localStorage.setItem('sparkcity_' + playerName.toLowerCase(), JSON.stringify(data));
    } catch(e) {}
  };

  useEffect(() => {
    if (player) saveState(player, completed, bonusXp);
  }, [player, completed, bonusXp, badges]);

  if (showSetup) {
    return React.createElement(SetupScreen, { onStart: (name) => {
      setPlayer(name);
      setShowSetup(false);
      try {
        const saved = localStorage.getItem('sparkcity_' + name.toLowerCase());
        if (saved) {
          const data = JSON.parse(saved);
          if (data.completed) setCompleted(data.completed);
          if (data.bonusXp !== undefined) setBonusXp(data.bonusXp);
          if (data.badges) setBadges(data.badges);
        }
      } catch(e) {}
    }});
  }

  if (view === "quest" && selectedQuest) {
    return React.createElement(QuestView, {
      quest: selectedQuest,
      player,
      isCompleted: completed[selectedQuest.id],
      onToggleComplete: () => toggleComplete(selectedQuest.id),
      onBack: () => setView("world"),
      onStartMiniGame: (game) => setMiniGame(game),
      onCompleteMiniGame: (bonusXpAmount) => {
        addXpPop(bonusXpAmount);
        setBonusXp(prev => prev + bonusXpAmount);
        setMiniGame(null);
      },
      onShowExplainer: (conceptId) => setShowExplainer(conceptId)
    });
  }

  if (miniGame) {
    return React.createElement(MiniGameView, {
      game: miniGame,
      onClose: () => setMiniGame(null),
      onComplete: (bonusXpAmount) => {
        addXpPop(bonusXpAmount);
        const newBonusXp = bonusXp + bonusXpAmount;
        setBonusXp(newBonusXp);
        setMiniGame(null);
        // Check for badge unlocks after mini-game
        const newHistory = { ...gameHistory, sessionCompletions: gameHistory.sessionCompletions + 1 };
        setGameHistory(newHistory);
        const result = checkBadgeUnlocks(completed, newBonusXp, newHistory, badges);
        if (result.newBadges.length > 0) {
          setBadges(result.badges);
          setBadgeToast(result.newBadges[0]);
        }
      }
    });
  }

  const levelIcons = ["\u{1F331}","\u{1F4A1}","\u{1F527}","\u{1F4E1}","\u26A1","\u{1F50D}","\u{1F4BB}","\u2699\uFE0F","\u{1F3D7}\uFE0F","\u{1F916}","\u{1F9EA}","\u{1F6E1}\uFE0F","\u{1F3C6}"];

  return React.createElement("div", { style: { minHeight: "100vh", background: "#131a2b" }},

    // â”€â”€ LEVELS MODAL â”€â”€
    showLevels && React.createElement("div", {
      onClick: () => setShowLevels(false),
      style: { position: "fixed", inset: 0, background: "rgba(0,0,0,0.7)", zIndex: 1000, display: "flex", alignItems: "center", justifyContent: "center", backdropFilter: "blur(6px)", animation: "fadeIn 0.2s ease" }
    },
      React.createElement("div", {
        onClick: (e) => e.stopPropagation(),
        style: { background: "#131a2b", border: "1px solid #1e293b", borderRadius: 20, padding: 32, maxWidth: 480, width: "90%", maxHeight: "85vh", overflowY: "auto", animation: "popIn 0.3s ease" }
      },
        React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 24 }},
          React.createElement("h2", { style: { fontFamily: "'Fredoka One', cursive", fontSize: 22, color: "#e2e8f0" }}, "\u{1F3AF} Engineer Ranks"),
          React.createElement("button", {
            onClick: () => setShowLevels(false),
            style: { background: "none", border: "none", color: "#64748b", fontSize: 22, cursor: "pointer" }
          }, "\u2715")
        ),

        // Level list
        titleNames.map((name, idx) => {
          const lvl = idx + 1;
          const unlocked = level >= lvl;
          const isCurrent = level === lvl;
          const reqXp = idx * 100;
          return React.createElement("div", {
            key: idx,
            style: {
              display: "flex", alignItems: "center", gap: 14, padding: "12px 14px",
              borderRadius: 12, marginBottom: 6,
              background: isCurrent ? "rgba(34,197,94,0.1)" : unlocked ? "rgba(26,35,53,0.6)" : "rgba(15,20,30,0.5)",
              border: isCurrent ? "1px solid rgba(34,197,94,0.3)" : "1px solid transparent",
              opacity: unlocked ? 1 : 0.45,
              transition: "all 0.3s"
            }
          },
            // Level number badge
            React.createElement("div", {
              style: {
                minWidth: 40, height: 40, borderRadius: "50%",
                background: isCurrent ? "linear-gradient(135deg, #22c55e, #16a34a)" : unlocked ? "rgba(34,197,94,0.15)" : "#1e293b",
                display: "flex", alignItems: "center", justifyContent: "center",
                fontSize: 18,
                border: isCurrent ? "2px solid #22c55e" : unlocked ? "1px solid rgba(34,197,94,0.3)" : "1px solid #334155",
                boxShadow: isCurrent ? "0 0 12px rgba(34,197,94,0.3)" : "none"
              }
            }, unlocked ? levelIcons[idx] : "\u{1F512}"),

            // Info
            React.createElement("div", { style: { flex: 1 }},
              React.createElement("div", { style: { fontWeight: 700, fontSize: 14, color: unlocked ? "#e2e8f0" : "#475569" }},
                name,
                isCurrent && React.createElement("span", { style: { marginLeft: 8, fontSize: 10, background: "#22c55e", color: "#fff", padding: "2px 8px", borderRadius: 10, fontWeight: 800 }}, "YOU")
              ),
              React.createElement("div", { style: { fontSize: 11, color: unlocked ? "#64748b" : "#334155" }},
                reqXp === 0 ? "Starting rank" : reqXp + " XP required"
              )
            ),

            // Level number
            React.createElement("div", { style: { fontSize: 12, fontWeight: 800, color: unlocked ? "#94a3b8" : "#334155" }}, "Lv." + lvl)
          );
        }),

        // Footer
        React.createElement("div", { style: { marginTop: 16, padding: 14, background: "rgba(30,41,59,0.4)", borderRadius: 10, textAlign: "center" }},
          React.createElement("p", { style: { fontSize: 12, color: "#64748b" }},
            level >= titleNames.length
              ? "\u{1F389} You've reached the highest rank! Spark City is safe!"
              : "Complete quests to earn 100 XP each and unlock new ranks!"
          )
        )
      )
    ),

    // Header
    React.createElement("header", { style: { background: "rgba(19,26,43,0.95)", backdropFilter: "blur(12px)", borderBottom: "2px solid #1e293b", padding: "16px 24px", position: "sticky", top: 0, zIndex: 100 }},
      React.createElement("div", { style: { maxWidth: 1400, margin: "0 auto", display: "flex", justifyContent: "space-between", alignItems: "center", flexWrap: "wrap", gap: 16 }},
        React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 12 }},
          React.createElement("div", { style: { fontSize: 32, animation: "bounce 2s infinite" }}, "\u{1F916}"),
          React.createElement("div", null,
            React.createElement("h1", { style: { fontFamily: "'Fredoka One', cursive", fontSize: 24, color: "#fff", margin: 0 }}, "Mission: Spark City"),
            React.createElement("p", { style: { fontSize: 12, color: "#94a3b8", margin: 0 }}, player + " the " + title)
          )
        ),
        React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 20, flex: 1, justifyContent: "flex-end" }},
          // Reset button
          React.createElement("button", {
            onClick: () => {
              if (confirm('Reset all progress for ' + player + '?')) {
                localStorage.removeItem('sparkcity_' + player.toLowerCase());
                setCompleted({});
                setBonusXp(0);
              }
            },
            style: { background: "none", border: "1px solid #475569", borderRadius: 6, padding: "6px 12px", color: "#64748b", fontSize: 12, cursor: "pointer", fontFamily: "Nunito", transition: "all 0.2s" },
            onMouseEnter: (e) => { e.currentTarget.style.color = "#94a3b8"; e.currentTarget.style.borderColor = "#64748b"; },
            onMouseLeave: (e) => { e.currentTarget.style.color = "#64748b"; e.currentTarget.style.borderColor = "#475569"; }
          }, "âš™ Reset"),
          // Achievements button
          React.createElement("button", {
            onClick: () => setShowAchievements(true),
            style: { background: "none", border: "1px solid #475569", borderRadius: 6, padding: "6px 12px", color: "#d4a853", fontSize: 12, cursor: "pointer", fontFamily: "Nunito", transition: "all 0.2s" },
            onMouseEnter: (e) => { e.currentTarget.style.background = "rgba(212,168,83,0.1)"; e.currentTarget.style.borderColor = "#d4a853"; },
            onMouseLeave: (e) => { e.currentTarget.style.background = "none"; e.currentTarget.style.borderColor = "#475569"; }
          }, "ðŸ† Badges"),
          // Parent Dashboard button
          React.createElement("button", {
            onClick: () => setShowParentDash(true),
            style: { background: "none", border: "1px solid #475569", borderRadius: 6, padding: "6px 12px", color: "#64748b", fontSize: 12, cursor: "pointer", fontFamily: "Nunito", transition: "all 0.2s" },
            onMouseEnter: (e) => { e.currentTarget.style.color = "#94a3b8"; e.currentTarget.style.borderColor = "#64748b"; },
            onMouseLeave: (e) => { e.currentTarget.style.color = "#64748b"; e.currentTarget.style.borderColor = "#475569"; }
          }, "ðŸ‘¨â€ðŸ‘©â€ðŸ‘§ Parent"),
          // Clickable level badge
          React.createElement("div", {
            onClick: () => setShowLevels(true),
            style: { textAlign: "right", cursor: "pointer", padding: "4px 8px", borderRadius: 8, transition: "background 0.2s" },
            onMouseEnter: (e) => e.currentTarget.style.background = "rgba(255,255,255,0.05)",
            onMouseLeave: (e) => e.currentTarget.style.background = "transparent"
          },
            React.createElement("div", { style: { fontSize: 20, fontWeight: 800, color: "#22c55e" }}, xp + " XP"),
            React.createElement("div", { style: { fontSize: 11, color: "#64748b" }}, "Level " + level + " \u2022 " + completedCount + "/" + totalProjects + " quests"),
            React.createElement("div", { style: { fontSize: 10, color: "#475569", textDecoration: "underline", marginTop: 2 }}, "View all ranks \u2192")
          ),
          React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 4, minWidth: 160 }},
            React.createElement("div", { style: { width: "100%", height: 10, background: "#1e293b", borderRadius: 6, overflow: "hidden", border: "1px solid #334155" }},
              React.createElement("div", { style: { width: (level >= titleNames.length ? 100 : xpProgress) + "%", height: "100%", background: "linear-gradient(90deg, #22c55e, #3b82f6)", borderRadius: 6, transition: "width 0.5s" }})
            ),
            React.createElement("div", { style: { fontSize: 10, color: "#475569", textAlign: "center" }},
              level >= titleNames.length ? "\u{1F3C6} Max Level!" : "Next: " + nextTitle + " (" + (xpForNextLevel - xp) + " XP)")
          )
        )
      )
    ),

    // World Map
    React.createElement("main", { style: { maxWidth: 1400, margin: "0 auto", padding: "40px 24px" }},
      React.createElement(WorldMap, {
        projects: PROJECTS,
        completed,
        onSelectQuest: (q) => { setSelectedQuest(q); setView("quest"); }
      })
    ),

    // XP Poppers
    xpPops.map(pop =>
      React.createElement("div", {
        key: pop.id,
        style: {
          position: "fixed",
          left: pop.x + "%",
          top: pop.y + "%",
          fontSize: 18,
          fontWeight: 800,
          color: "#22c55e",
          animation: "xpPop 0.6s ease-out",
          pointerEvents: "none",
          textShadow: "0 0 8px rgba(34,197,94,0.5)"
        }
      }, "+" + pop.xp + " XP")
    )
  ,

    // Badge Toast
    badgeToast && React.createElement(BadgeToast, { badge: badgeToast, onDismiss: () => setBadgeToast(null) }),

    // Achievements Modal  
    showAchievements && React.createElement(AchievementModal, { badges, onClose: () => setShowAchievements(false) }),

    // Parent Dashboard
    showParentDash && React.createElement(ParentDashboard, { completed, bonusXp, badges, onClose: () => setShowParentDash(false) }),

    // Explainer
    showExplainer && React.createElement(ExplainerView, {
      conceptId: showExplainer,
      onClose: () => setShowExplainer(null),
      onXpEarned: (xp) => { addXpPop(xp); setBonusXp(prev => prev + xp); }
    })

  );
}

// â”€â”€â”€ SETUP SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function SetupScreen({ onStart }) {
  const [name, setName] = useState("");

  return React.createElement("div", { style: { minHeight: "100vh", display: "flex", alignItems: "center", justifyContent: "center", background: "#131a2b", padding: 24, position: "relative", overflow: "hidden" }},
    React.createElement("div", { style: { position: "absolute", top: 0, left: 0, right: 0, bottom: 0, opacity: 0.05, fontSize: 200, display: "flex", alignItems: "center", justifyContent: "center" }}, "ðŸ¤–"),
    React.createElement("div", { style: { textAlign: "center", maxWidth: 600, position: "relative", zIndex: 1 }},
      React.createElement("div", { style: { fontSize: 120, marginBottom: 24, animation: "popIn 0.6s ease" }}, "ðŸ¤–"),
      React.createElement("h1", { style: { fontFamily: "'Fredoka One', cursive", fontSize: 44, color: "#fff", marginBottom: 12 }}, "Mission: Spark City"),
      React.createElement("p", { style: { color: "#22c55e", fontSize: 18, fontWeight: 700, marginBottom: 12 }}, "Sparky Needs Your Help!"),
      React.createElement("p", { style: { color: "#94a3b8", fontSize: 16, lineHeight: 1.8, marginBottom: 32 }}, "Sparky, a friendly robot, crash-landed in the workshop! The city is going dark. As a Junior Engineer, YOU must repair Sparky and save Spark City by completing 12 epic quests!"),
      React.createElement("div", { style: { display: "flex", gap: 12, justifyContent: "center", marginBottom: 32 }},
        React.createElement("input", {
          type: "text",
          placeholder: "Enter your name, engineer...",
          value: name,
          onChange: (e) => setName(e.target.value),
          onKeyDown: (e) => e.key === "Enter" && name.trim() && onStart(name.trim()),
          style: { padding: "14px 20px", borderRadius: 12, border: "2px solid #334155", background: "#1e293b", color: "#fff", fontSize: 16, outline: "none", width: 300, fontFamily: "Nunito", transition: "border 0.2s" }
        }),
        React.createElement("button", {
          onClick: () => name.trim() && onStart(name.trim()),
          style: { padding: "14px 32px", borderRadius: 12, border: "none", background: "linear-gradient(135deg, #22c55e, #16a34a)", color: "#fff", fontSize: 16, fontWeight: 700, cursor: "pointer", fontFamily: "Nunito", boxShadow: "0 6px 20px rgba(34,197,94,0.3)" }
        }, "Start Mission \u{1F680}")
      ),
      React.createElement("div", { style: { padding: 24, background: "rgba(34,197,94,0.06)", borderRadius: 12, border: "1px solid rgba(34,197,94,0.15)" }},
        React.createElement("p", { style: { fontSize: 14, color: "#94a3b8", lineHeight: 1.8 }}, "Your mission: Fix Sparky by building Arduino projects. Each quest teaches you real electronics and programming. Earn XP, level up, and become the City Hero!")
      )
    )
  );
}

// â”€â”€â”€ WORLD MAP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function WorldMap({ projects, completed, onSelectQuest }) {
  return React.createElement("div", { style: { animation: "fadeIn 0.6s ease" }},
    React.createElement("h2", { style: { fontFamily: "'Fredoka One', cursive", fontSize: 28, color: "#e2e8f0", marginBottom: 12, textAlign: "center" }}, "Spark City Quest Map"),
    React.createElement("p", { style: { fontSize: 14, color: "#94a3b8", marginBottom: 32, textAlign: "center" }}, "Click any location to start a quest. Green = completed, Pulsing = current, Grey = locked"),

    React.createElement("div", { style: { position: "relative", height: 800, background: "linear-gradient(135deg, rgba(30,41,59,0.3), rgba(30,41,59,0.1))", borderRadius: 20, border: "1px solid #1e293b", padding: 40, overflow: "visible" }},
      // Quest nodes in a winding path
      projects.map((p, idx) => {
        const row = Math.floor(idx / 3);
        const colRaw = idx % 3;
        // Reverse direction on odd rows for a snake/winding path
        const col = row % 2 === 0 ? colRaw : (2 - colRaw);
        const x = 20 + col * 30;
        const y = 8 + row * 22;
        const isCompleted = completed[p.id];

        return React.createElement(React.Fragment, { key: p.id },
          // Connector line (skip â€” using CSS path between nodes is complex, keep it clean)


          // Quest node
          React.createElement("div", {
            onClick: () => onSelectQuest(p),
            style: {
              position: "absolute",
              left: x + "%",
              top: y + "%",
              transform: "translate(-50%, -50%)",
              cursor: "pointer",
              zIndex: 10
            }
          },
            React.createElement("div", {
              style: {
                width: 80,
                height: 80,
                borderRadius: "50%",
                background: isCompleted ? "rgba(34,197,94,0.15)" : "rgba(26,35,53,0.85)",
                border: isCompleted ? "2px solid rgba(34,197,94,0.4)" : "2px solid " + p.color,
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                fontSize: 32,
                animation: isCompleted ? "none" : "pulse 2s ease-in-out infinite",
                boxShadow: isCompleted ? "0 0 20px rgba(34,197,94,0.2)" : "0 0 16px " + p.color + "30",
                transition: "all 0.3s"
              },
              onMouseEnter: (e) => {
                e.currentTarget.style.transform = "scale(1.1)";
                e.currentTarget.style.boxShadow = "0 0 30px " + p.color + "50";
              },
              onMouseLeave: (e) => {
                e.currentTarget.style.transform = "scale(1)";
                e.currentTarget.style.boxShadow = isCompleted ? "0 0 20px rgba(34,197,94,0.2)" : "0 0 16px " + p.color + "30";
              }
            }, isCompleted ? "âœ“" : p.icon)
          ),

          // Node label
          React.createElement("div", {
            style: {
              position: "absolute",
              left: x + "%",
              top: (y + 6) + "%",
              transform: "translateX(-50%)",
              fontSize: 11,
              fontWeight: 700,
              color: "#94a3b8",
              textAlign: "center",
              maxWidth: 100,
              pointerEvents: "none"
            }
          }, p.id + ". " + p.title)
        );
      })
    )
  );
}

// â”€â”€â”€ QUEST VIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function QuestView({ quest, player, isCompleted, onToggleComplete, onBack, onStartMiniGame, onCompleteMiniGame, onShowExplainer }) {
  const [currentStep, setCurrentStep] = useState(0);
  const [visitedSteps, setVisitedSteps] = useState({0: true});
  const contentRef = useRef(null);

  const steps = [
    { id: "story", label: "Story", icon: "ðŸ“–", shortLabel: "Story" },
    { id: "overview", label: "Overview", icon: "ðŸ“‹", shortLabel: "Overview" },
    { id: "wiring", label: "Wiring", icon: "ðŸ”Œ", shortLabel: "Wire" },
    { id: "code", label: "Code", icon: "ðŸ’»", shortLabel: "Code" },
    { id: "challenge", label: "Challenge", icon: "ðŸŽ¯", shortLabel: "Challenge" }
  ];

  const allStepsVisited = steps.every((_, i) => visitedSteps[i]);

  const goToStep = (idx) => {
    setCurrentStep(idx);
    setVisitedSteps(prev => ({...prev, [idx]: true}));
    if (contentRef.current) contentRef.current.scrollTo({top: 0, behavior: "smooth"});
    window.scrollTo({top: 0, behavior: "smooth"});
  };

  const nextStep = () => { if (currentStep < steps.length - 1) goToStep(currentStep + 1); };
  const prevStep = () => { if (currentStep > 0) goToStep(currentStep - 1); };

  const handleComplete = () => {
    onToggleComplete();
    if (!isCompleted) {
      setTimeout(() => {
        const gameType = ["match", "debug", "quiz", "wiring", "codecomplete"][quest.id % 5];
        let game;
        if (gameType === "match") game = generateComponentMatchGame(quest.id);
        else if (gameType === "debug") game = generateDebugCodeGame(quest.id);
        else if (gameType === "wiring") game = generateWiringGame(quest.id);
        else if (gameType === "codecomplete") game = generateCodeCompletionGame(quest.id);
        else game = generateQuizGame(quest.id);
        onBack();
        setTimeout(() => onStartMiniGame(game), 100);
      }, 400);
    }
  };

  return React.createElement("div", { style: { minHeight: "100vh", background: "#131a2b" }},
    // Top bar
    React.createElement("div", { style: { background: "rgba(19,26,43,0.95)", backdropFilter: "blur(12px)", borderBottom: "1px solid #1e293b", padding: "12px 24px", display: "flex", alignItems: "center", gap: 16, position: "sticky", top: 0, zIndex: 100 }},
      React.createElement("button", {
        onClick: onBack,
        style: { background: "none", border: "1px solid #334155", borderRadius: 8, color: "#94a3b8", padding: "8px 16px", cursor: "pointer", fontFamily: "Nunito", fontSize: 14, transition: "all 0.2s" }
      }, "â† Back to Map"),
      React.createElement("span", { style: { fontSize: 28 }}, quest.icon),
      React.createElement("div", { style: { flex: 1 }},
        React.createElement("span", { style: { fontSize: 10, fontWeight: 700, textTransform: "uppercase", letterSpacing: 1, color: quest.color }}, "Quest " + quest.id),
        React.createElement("h2", { style: { fontSize: 18, fontWeight: 800, color: "#e2e8f0", margin: 0 }}, quest.title)
      ),
      isCompleted && React.createElement("div", { style: { fontSize: 24, color: "#22c55e", fontWeight: 800 }}, "âœ“ COMPLETED")
    ),

    // Step Progress
    React.createElement("div", { style: { background: "rgba(19,26,43,0.8)", padding: "16px 24px 12px", borderBottom: "1px solid #1e293b" }},
      React.createElement("div", { style: { maxWidth: 800, margin: "0 auto", display: "flex", alignItems: "center", gap: 0, overflowX: "auto", paddingBottom: 8 }},
        steps.map((step, idx) =>
          React.createElement(React.Fragment, { key: step.id },
            React.createElement("div", {
              onClick: () => goToStep(idx),
              style: { display: "flex", flexDirection: "column", alignItems: "center", cursor: "pointer", flex: "0 0 auto", position: "relative", zIndex: 2, transition: "all 0.3s" }
            },
              React.createElement("div", {
                style: {
                  width: 44, height: 44, borderRadius: "50%",
                  display: "flex", alignItems: "center", justifyContent: "center",
                  fontSize: 20,
                  background: idx === currentStep ? quest.color : visitedSteps[idx] ? "rgba(34,197,94,0.15)" : "rgba(30,41,59,0.8)",
                  border: idx === currentStep ? "3px solid " + quest.color : visitedSteps[idx] ? "2px solid rgba(34,197,94,0.4)" : "2px solid #334155",
                  color: idx === currentStep ? "#fff" : visitedSteps[idx] ? "#22c55e" : "#64748b",
                  transition: "all 0.3s",
                  boxShadow: idx === currentStep ? "0 0 16px " + quest.color + "40" : "none"
                }
              }, visitedSteps[idx] && idx !== currentStep ? "âœ“" : step.icon),
              React.createElement("span", { style: { marginTop: 6, fontSize: 10, fontWeight: 600, color: "#94a3b8", whiteSpace: "nowrap" }}, step.shortLabel)
            ),
            idx < steps.length - 1 && React.createElement("div", {
              style: {
                flex: 1, height: 3, margin: "0 4px", marginBottom: 20,
                background: visitedSteps[idx + 1] ? "rgba(34,197,94,0.3)" : "#1e293b",
                borderRadius: 2, transition: "all 0.4s", minWidth: 24
              }
            })
          )
        )
      )
    ),

    // Content
    React.createElement("div", { ref: contentRef, style: { maxWidth: 900, margin: "0 auto", padding: "28px 24px 120px" }},
      // STEP 0: Story
      currentStep === 0 && React.createElement("div", { style: { animation: "fadeIn 0.3s ease" }},
        React.createElement("div", { style: { background: "rgba(26,35,53,0.85)", borderRadius: 20, padding: 32, border: "2px solid " + quest.color + "40", marginBottom: 20, textAlign: "center" }},
          React.createElement("div", { style: { fontSize: 80, marginBottom: 20 }}, "ðŸ¤–"),
          React.createElement("div", { style: { fontSize: 24, fontFamily: "'Fredoka One', cursive", color: quest.color, marginBottom: 12 }}, "Sparky says..."),
          React.createElement("div", { style: { fontSize: 18, color: "#e2e8f0", lineHeight: 2, fontStyle: "italic", marginBottom: 24 }}, "\"" + quest.questIntro + "\""),
          React.createElement("div", { style: { fontSize: 14, color: "#94a3b8", padding: 16, background: "rgba(30,41,59,0.5)", borderRadius: 12 }},
            "This quest will repair Sparky's " + quest.systemRepaired + " system!"
          )
        )
      ),

      // STEP 1: Overview
      currentStep === 1 && React.createElement("div", { style: { animation: "fadeIn 0.3s ease" }},
        React.createElement("div", { style: { background: "rgba(26,35,53,0.85)", borderRadius: 16, padding: 24, marginBottom: 20, border: "1px solid #1e293b" }},
          React.createElement("h3", { style: { color: "#e2e8f0", marginBottom: 12, fontSize: 18 }}, "What you'll build"),
          React.createElement("p", { style: { fontSize: 16, lineHeight: 1.8, color: "#b0bec5" }}, quest.description)
        ),

        React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 16, marginBottom: 20 }},
          React.createElement("div", { style: { background: "rgba(26,35,53,0.85)", borderRadius: 16, padding: 20, border: "1px solid #1e293b" }},
            React.createElement("h4", { style: { color: "#94a3b8", marginBottom: 12, fontSize: 13, fontWeight: 700, textTransform: "uppercase", letterSpacing: 1 }}, "ðŸ§© Components"),
            quest.components.map((c, i) =>
              React.createElement("div", { key: i, style: { padding: "6px 0", color: "#b0bec5", fontSize: 14, borderBottom: i < quest.components.length - 1 ? "1px solid rgba(30,41,59,0.6)" : "none" }}, "â€¢ " + c)
            )
          ),
          React.createElement("div", { style: { background: "rgba(26,35,53,0.85)", borderRadius: 16, padding: 20, border: "1px solid #1e293b" }},
            React.createElement("h4", { style: { color: "#94a3b8", marginBottom: 12, fontSize: 13, fontWeight: 700, textTransform: "uppercase", letterSpacing: 1 }}, "ðŸ’¡ You'll Learn"),
            quest.learn.map((l, i) =>
              React.createElement("div", { key: i, style: { padding: "6px 0", color: "#b0bec5", fontSize: 14, borderBottom: i < quest.learn.length - 1 ? "1px solid rgba(30,41,59,0.6)" : "none" }}, "âœ“ " + l)
            )
          )
        ),

        React.createElement("div", { style: { background: "rgba(26,35,53,0.85)", borderRadius: 16, padding: 20, border: "1px solid #1e293b" }},
          React.createElement("h4", { style: { color: "#d4a853", marginBottom: 8, fontSize: 13, fontWeight: 700, textTransform: "uppercase", letterSpacing: 1 }}, "ðŸ”¬ Science Corner"),
          React.createElement("p", { style: { color: "#b0bec5", lineHeight: 1.7, fontSize: 15, marginBottom: 16 }}, quest.science),
          EXPLAINER_CONCEPTS.filter(c => c.projectIds && c.projectIds.includes(quest.id)).length > 0 &&
            React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 8, marginTop: 8 }},
              EXPLAINER_CONCEPTS.filter(c => c.projectIds && c.projectIds.includes(quest.id)).map(c =>
                React.createElement("button", {
                  key: c.id,
                  onClick: () => onShowExplainer(c.id),
                  style: { background: "linear-gradient(135deg, #d4a85320, #d4a85310)", border: "1px solid #d4a85340", borderRadius: 8, padding: "8px 14px", color: "#d4a853", fontSize: 13, cursor: "pointer", fontFamily: "Nunito", transition: "all 0.2s" },
                  onMouseEnter: (e) => { e.currentTarget.style.background = "linear-gradient(135deg, #d4a85340, #d4a85320)"; },
                  onMouseLeave: (e) => { e.currentTarget.style.background = "linear-gradient(135deg, #d4a85320, #d4a85310)"; }
                }, "ðŸ“– " + c.title)
              )
            )
        )
      ),

      // STEP 2: Wiring
      currentStep === 2 && React.createElement("div", { style: { animation: "fadeIn 0.3s ease" }},
        quest.diagram && React.createElement(WiringDiagram, { diagram: quest.diagram, color: quest.color }),
        React.createElement("div", { style: { background: "rgba(26,35,53,0.85)", borderRadius: 16, padding: 24, border: "1px solid #1e293b" }},
          React.createElement("h3", { style: { color: "#e2e8f0", marginBottom: 8, fontSize: 18 }}, "âš¡ Wiring Connections"),
          React.createElement("p", { style: { color: "#7e8a9a", marginBottom: 20, fontSize: 14 }}, "Follow each connection carefully!"),
          quest.wiring.map((w, i) =>
            React.createElement("div", { key: i, style: { display: "flex", alignItems: "center", gap: 16, padding: "14px 0", borderBottom: i < quest.wiring.length - 1 ? "1px solid rgba(30,41,59,0.6)" : "none" }},
              React.createElement("div", { style: { minWidth: 40, height: 40, borderRadius: "50%", background: quest.color + "18", color: quest.color, display: "flex", alignItems: "center", justifyContent: "center", fontWeight: 800, fontSize: 16, border: "1px solid " + quest.color + "40" }}, i + 1),
              React.createElement("div", null,
                React.createElement("div", { style: { color: "#e2e8f0", fontWeight: 700, fontSize: 15 }}, w.from + (w.to ? " â†’ " + w.to : "")),
                w.note && React.createElement("div", { style: { color: "#7e8a9a", fontSize: 13, marginTop: 3 }}, w.note)
              )
            )
          )
        )
      ),

      // STEP 3: Code
      currentStep === 3 && React.createElement("div", { style: { animation: "fadeIn 0.3s ease" }},
        React.createElement("div", { style: { background: "rgba(26,35,53,0.85)", borderRadius: 16, padding: 24, border: "1px solid #1e293b" }},
          React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 16 }},
            React.createElement("h3", { style: { color: "#e2e8f0", fontSize: 18 }}, "ðŸ’» Arduino Code"),
            React.createElement("button", {
              onClick: () => {
                const el = document.createElement("textarea");
                el.value = quest.code.replace(/<[^>]+>/g, "");
                document.body.appendChild(el);
                el.select();
                document.execCommand("copy");
                document.body.removeChild(el);
              },
              style: { padding: "8px 18px", borderRadius: 8, border: "1px solid #334155", background: "rgba(30,41,59,0.8)", color: "#94a3b8", cursor: "pointer", fontSize: 13, fontFamily: "Nunito", transition: "all 0.2s" }
            }, "ðŸ“‹ Copy Code"),
            quest.wokwiUrl && React.createElement("button", {
              onClick: () => window.open(quest.wokwiUrl, "_blank"),
              style: { padding: "8px 18px", borderRadius: 8, border: "1px solid #22c55e", background: "rgba(34,197,94,0.1)", color: "#22c55e", cursor: "pointer", fontSize: 13, fontFamily: "Nunito", transition: "all 0.2s" }
            }, "ðŸ”¬ Try in Simulator")
          ),
          React.createElement("pre", null,
            React.createElement("code", { dangerouslySetInnerHTML: { __html: highlightArduinoCode(quest.code) }})
          )
        )
      ),

      // STEP 4: Challenge
      currentStep === 4 && React.createElement("div", { style: { animation: "fadeIn 0.3s ease" }},
        React.createElement("div", { style: { background: "rgba(26,35,53,0.85)", borderRadius: 16, padding: 28, border: "1px solid " + quest.color + "40", marginBottom: 20 }},
          React.createElement("h3", { style: { color: quest.color, marginBottom: 16, fontSize: 22 }}, "ðŸŽ¯ Level Up Challenge!"),
          React.createElement("p", { style: { color: "#b0bec5", lineHeight: 1.8, fontSize: 16 }}, quest.challenge)
        ),

        allStepsVisited && React.createElement("div", { style: { textAlign: "center" }},
          React.createElement("button", {
            onClick: handleComplete,
            style: {
              padding: "16px 44px", borderRadius: 14, border: "none",
              background: isCompleted ? "rgba(71,85,105,0.6)" : "linear-gradient(135deg, #22c55e, #16a34a)",
              color: "#fff", fontSize: 17, fontWeight: 700, cursor: "pointer", fontFamily: "Nunito",
              transition: "all 0.3s", boxShadow: isCompleted ? "none" : "0 4px 20px rgba(34,197,94,0.3)", marginTop: 24
            }
          }, isCompleted ? "âœ“ Quest Complete" : "âœ“ Complete Quest (+100 XP) & Play Mini-Game (up to +50 XP)")
        )
      ),

      // Navigation
      React.createElement("div", { style: { display: "flex", justifyContent: "space-between", marginTop: 32, gap: 16 }},
        currentStep > 0
          ? React.createElement("button", {
              onClick: prevStep,
              style: {
                padding: "14px 28px", borderRadius: 12, border: "1px solid #334155",
                background: "rgba(30,41,59,0.6)", color: "#94a3b8", fontSize: 15, fontWeight: 700,
                cursor: "pointer", fontFamily: "Nunito", transition: "all 0.2s", display: "flex", alignItems: "center", gap: 8
              }
            }, "â† Back")
          : React.createElement("div"),

        currentStep < steps.length - 1
          ? React.createElement("button", {
              onClick: nextStep,
              style: {
                padding: "14px 32px", borderRadius: 12, border: "none",
                background: quest.color, color: "#fff", fontSize: 16, fontWeight: 800,
                cursor: "pointer", fontFamily: "Nunito", transition: "all 0.3s",
                display: "flex", alignItems: "center", gap: 8,
                boxShadow: "0 4px 16px " + quest.color + "30", marginLeft: "auto"
              }
            }, "Next â†’")
          : React.createElement("div")
      )
    )
  );
}

// â”€â”€â”€ MINI-GAME VIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function MiniGameView({ game, onClose, onComplete }) {
  const [gameState, setGameState] = useState(game);

  if (gameState.type === "match") {
    return React.createElement(ComponentMatchGame, { game: gameState, setGame: setGameState, onComplete, onClose });
  }
  if (gameState.type === "debug") {
    return React.createElement(DebugCodeGame, { game: gameState, setGame: setGameState, onComplete, onClose });
  }
  if (gameState.type === "quiz") {
    return React.createElement(CircuitQuizGame, { game: gameState, setGame: setGameState, onComplete, onClose });
  }
  if (gameState.type === "wiring") {
    return React.createElement(WiringGame, { game: gameState, setGame: setGameState, onComplete, onClose });
  }
  if (gameState.type === "codecomplete") {
    return React.createElement(CodeCompletionGame, { game: gameState, setGame: setGameState, onComplete, onClose });
  }
}

function ComponentMatchGame({ game, setGame, onComplete, onClose }) {
  const [flipped, setFlipped] = useState({});
  const [matched, setMatched] = useState({});
  const [movesLeft, setMovesLeft] = useState(20);

  const handleFlip = (idx) => {
    if (flipped[idx] || matched[idx] || Object.keys(flipped).length >= 2) return;

    const newFlipped = {...flipped, [idx]: true};
    setFlipped(newFlipped);

    if (Object.keys(newFlipped).length === 2) {
      const indices = Object.keys(newFlipped).map(Number);
      const same = game.cards[indices[0]].label === game.cards[indices[1]].label;

      if (same) {
        setMatched(prev => ({...prev, [indices[0]]: true, [indices[1]]: true}));
      }

      setTimeout(() => setFlipped({}), 600);
      setMovesLeft(movesLeft - 1);

      if (Object.keys(matched).length === game.cards.length - 2) {
        setTimeout(() => onComplete(50), 800);
      }
    }
  };

  return React.createElement("div", { style: { minHeight: "100vh", background: "#131a2b", padding: 24, display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center" }},
    React.createElement("h2", { style: { fontFamily: "'Fredoka One', cursive", fontSize: 28, color: "#22c55e", marginBottom: 12 }}, "ðŸŽ® Component Matching Game"),
    React.createElement("p", { style: { color: "#94a3b8", marginBottom: 24 }}, "Match the component pairs! Moves left: " + movesLeft),
    React.createElement("div", { style: { display: "grid", gridTemplateColumns: "repeat(4, 1fr)", gap: 12, marginBottom: 24 }},
      game.cards.map((card, idx) =>
        React.createElement("div", {
          onClick: () => handleFlip(idx),
          key: idx,
          style: {
            width: 80,
            height: 80,
            background: flipped[idx] || matched[idx] ? "rgba(34,197,94,0.15)" : "rgba(26,35,53,0.85)",
            border: flipped[idx] || matched[idx] ? "2px solid #22c55e" : "2px solid #334155",
            borderRadius: 12,
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            fontSize: 32,
            cursor: "pointer",
            transition: "all 0.3s",
            color: flipped[idx] || matched[idx] ? "#e2e8f0" : "#475569"
          }
        }, flipped[idx] || matched[idx] ? (card.img ? card.img : card.label) : "?")
      )
    ),
    matched && Object.keys(matched).length === game.cards.length && React.createElement("div", { style: { textAlign: "center", padding: 24, background: "rgba(34,197,94,0.15)", borderRadius: 12, border: "1px solid rgba(34,197,94,0.3)" }},
      React.createElement("p", { style: { color: "#22c55e", fontSize: 18, fontWeight: 700 }}, "âœ“ Perfect! +50 Bonus XP!"),
      React.createElement("button", {
        onClick: onClose,
        style: { marginTop: 12, padding: "10px 20px", borderRadius: 8, border: "none", background: "#22c55e", color: "#000", fontWeight: 700, cursor: "pointer" }
      }, "Continue")
    )
  );
}

function DebugCodeGame({ game, setGame, onComplete, onClose }) {
  const [answered, setAnswered] = useState(null);
  const [correct, setCorrect] = useState(null);
  const [round, setRound] = useState(0);
  const scoreRef = useRef(0);

  const currentBug = game.bugs[round];

  const handleAnswer = (answerIdx) => {
    if (answered !== null) return;
    setAnswered(answerIdx);
    const isCorrect = answerIdx === currentBug.bugLine;
    setCorrect(isCorrect);

    if (isCorrect) {
      scoreRef.current += 1;
    }

    setTimeout(() => {
      if (round < 2) {
        setAnswered(null);
        setCorrect(null);
        setRound(round + 1);
      } else {
        onComplete(scoreRef.current * 10);
      }
    }, 1200);
  };

  return React.createElement("div", { style: { minHeight: "100vh", background: "#131a2b", padding: 24, display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center" }},
    React.createElement("h2", { style: { fontFamily: "'Fredoka One', cursive", fontSize: 28, color: "#a855f7", marginBottom: 12 }}, "ðŸ› Debug the Code"),
    React.createElement("p", { style: { color: "#94a3b8", marginBottom: 8 }}, "Round " + (round + 1) + " of 3 â€” Find the line with the bug!"),
    React.createElement("p", { style: { color: "#a855f7", fontSize: 13, marginBottom: 24, fontStyle: "italic" }}, "Hint: " + currentBug.hint),
    React.createElement("pre", { style: { background: "#0d1117", border: "1px solid #30363d", borderRadius: 8, padding: 16, marginBottom: 24, color: "#e2e8f0", fontFamily: "'Fira Code', monospace" }}, currentBug.code),
    React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 12 }},
      currentBug.answers.map((ans, idx) => {
        var isCorrectLine = answered !== null && idx === currentBug.bugLine;
        var isWrongPick = answered === idx && !correct;
        return React.createElement("button", {
          onClick: () => handleAnswer(idx),
          key: idx,
          style: {
            padding: "12px 24px",
            borderRadius: 8,
            border: "2px solid " + (isCorrectLine ? "#22c55e" : isWrongPick ? "#ef4444" : "#334155"),
            background: isCorrectLine ? "rgba(34,197,94,0.15)" : isWrongPick ? "rgba(239,68,68,0.15)" : "rgba(26,35,53,0.85)",
            color: "#e2e8f0",
            cursor: answered !== null ? "default" : "pointer",
            fontWeight: 700,
            transition: "all 0.3s"
          }
        }, ans + (isCorrectLine && answered !== null ? " âœ“" : ""));
      })
    ),
    answered !== null && correct !== null && React.createElement("div", { style: { marginTop: 24, padding: 16, background: correct ? "rgba(34,197,94,0.15)" : "rgba(239,68,68,0.15)", borderRadius: 8, border: "1px solid " + (correct ? "rgba(34,197,94,0.3)" : "rgba(239,68,68,0.3)"), textAlign: "center" }},
      React.createElement("p", { style: { color: correct ? "#22c55e" : "#ef4444", fontWeight: 700, marginBottom: 8 }},
        correct ? "âœ“ Correct! Nice catch!" : "âœ— Not quite â€” the bug was on " + currentBug.answers[currentBug.bugLine]),
      React.createElement("p", { style: { color: "#94a3b8", fontSize: 13 }}, currentBug.hint)
    ),
    React.createElement("div", { style: { marginTop: 16, color: "#64748b", fontSize: 13, textAlign: "center" }}, "Score: " + scoreRef.current + "/" + (round + 1))
  );
}

function CircuitQuizGame({ game, setGame, onComplete, onClose }) {
  const [answers, setAnswers] = useState({});
  const [submitted, setSubmitted] = useState(false);

  const handleAnswer = (qIdx, answer) => {
    if (!submitted) setAnswers(prev => ({...prev, [qIdx]: answer}));
  };

  const correctCount = game.questions.filter((q, i) => answers[i] === q.a).length;
  const earnedXp = correctCount * 10;
  const allAnswered = game.questions.every((_, i) => answers[i]);

  return React.createElement("div", { style: { minHeight: "100vh", background: "#131a2b", padding: 24, display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center" }},
    React.createElement("h2", { style: { fontFamily: "'Fredoka One', cursive", fontSize: 28, color: "#06b6d4", marginBottom: 12 }}, "ðŸ’­ Circuit Quiz"),
    React.createElement("div", { style: { maxWidth: 600, width: "100%" }},
      game.questions.map((q, qIdx) => {
        var isCorrect = submitted && answers[qIdx] === q.a;
        var isWrong = submitted && answers[qIdx] !== q.a;
        return React.createElement("div", { key: qIdx, style: { marginBottom: 20, padding: 16, background: "rgba(26,35,53,0.85)", borderRadius: 12, border: submitted ? (isCorrect ? "1px solid rgba(34,197,94,0.4)" : "1px solid rgba(239,68,68,0.4)") : "1px solid #1e293b" }},
          React.createElement("p", { style: { color: "#e2e8f0", fontWeight: 700, marginBottom: 12 }},
            (qIdx + 1) + ". " + q.q,
            submitted && React.createElement("span", { style: { marginLeft: 8, color: isCorrect ? "#22c55e" : "#ef4444" }}, isCorrect ? " âœ“" : " âœ—")
          ),
          React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 8 }},
            q.options.map((opt, oIdx) => {
              var optIsCorrect = submitted && opt === q.a;
              var optIsWrongPick = submitted && answers[qIdx] === opt && opt !== q.a;
              return React.createElement("label", { key: oIdx, style: { display: "flex", alignItems: "center", gap: 12, padding: 10, borderRadius: 8, background: optIsCorrect ? "rgba(34,197,94,0.15)" : optIsWrongPick ? "rgba(239,68,68,0.1)" : answers[qIdx] === opt ? "rgba(6,182,212,0.15)" : "transparent", border: optIsCorrect ? "1px solid #22c55e" : optIsWrongPick ? "1px solid #ef4444" : answers[qIdx] === opt ? "1px solid #06b6d4" : "1px solid #334155", cursor: submitted ? "default" : "pointer", transition: "all 0.2s" }},
                React.createElement("input", {
                  type: "radio",
                  name: "q" + qIdx,
                  checked: answers[qIdx] === opt,
                  onChange: () => handleAnswer(qIdx, opt),
                  disabled: submitted,
                  style: { width: 18, height: 18, cursor: submitted ? "default" : "pointer" }
                }),
                React.createElement("span", { style: { color: optIsCorrect ? "#22c55e" : optIsWrongPick ? "#ef4444" : "#94a3b8", fontWeight: optIsCorrect ? 700 : 400 }}, opt + (optIsCorrect ? " âœ“" : ""))
              );
            })
          )
        );
      })
    ),
    !submitted && React.createElement("button", {
      onClick: () => setSubmitted(true),
      disabled: !allAnswered,
      style: {
        marginTop: 24, padding: "14px 32px", borderRadius: 8, border: "none",
        background: allAnswered ? "#06b6d4" : "#334155", color: "#fff",
        fontWeight: 700, cursor: allAnswered ? "pointer" : "not-allowed", fontSize: 16
      }
    }, "Submit Answers"),
    submitted && React.createElement("div", { style: { marginTop: 24, padding: 24, background: earnedXp > 0 ? "rgba(34,197,94,0.15)" : "rgba(239,68,68,0.1)", borderRadius: 12, border: "1px solid " + (earnedXp > 0 ? "rgba(34,197,94,0.3)" : "rgba(239,68,68,0.3)"), textAlign: "center" }},
      React.createElement("p", { style: { color: earnedXp > 0 ? "#22c55e" : "#ef4444", fontSize: 18, fontWeight: 700 }},
        "Quiz Complete! " + correctCount + "/" + game.questions.length + " correct" + (earnedXp > 0 ? " â€” +" + earnedXp + " Bonus XP!" : " â€” no bonus XP this time")),
      React.createElement("p", { style: { color: "#94a3b8", fontSize: 13, marginTop: 8 }},
        earnedXp > 0 ? "Review your answers above â€” correct answers are highlighted in green." : "Review the correct answers above in green, then try again next time!"),
      React.createElement("button", {
        onClick: () => onComplete(earnedXp),
        style: { marginTop: 16, padding: "12px 28px", borderRadius: 8, border: "none", background: earnedXp > 0 ? "#22c55e" : "#64748b", color: earnedXp > 0 ? "#000" : "#fff", fontWeight: 700, cursor: "pointer", fontSize: 15 }
      }, earnedXp > 0 ? "Collect +" + earnedXp + " XP & Continue" : "Continue")
    )
  );
}

// â”€â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(React.createElement(App));
</script>
</body>
</html>